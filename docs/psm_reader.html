---

title: Base structure for PSM readers


keywords: fastai
sidebar: home_sidebar



nb_path: "nbdev_nbs/io/psm_reader/psm_reader.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbdev_nbs/io/psm_reader/psm_reader.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="translate_other_modification" class="doc_header"><code>translate_other_modification</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/io/psm_reader/psm_reader.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>translate_other_modification</code>(<strong><code>mod_str</code></strong>:<code>str</code>, <strong><code>mod_dict</code></strong>:<code>dict</code>)</p>
</blockquote>
<p>Translate modifications of <code>mod_str</code> to the AlphaBase
format mapped by mod_dict.
Args:
    mod_str (str): mod list in str format, seperated by ';',
        e.g. ModA;ModB
    mod_dict (dict): translate mod dict from others to AlphaBase,
        e.g. for pFind, key=['Phospho[S]','Oxidation[M]'],
        value=['Phospho@S','Oxidation@M']
Returns:
    str: new mods in AlphaBase format seperated by ';'. if any
         modification is not in <code>mod_dict</code>, return pd.NA.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="keep_modifications" class="doc_header"><code>keep_modifications</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/io/psm_reader/psm_reader.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>keep_modifications</code>(<strong><code>mod_str</code></strong>:<code>str</code>, <strong><code>mod_set</code></strong>:<code>set</code>)</p>
</blockquote>
<p>Check if modifications of <code>mod_str</code> are in <code>mod_set</code>.
Args:
    mod_str (str): mod list in str format, seperated by ';',
        e.g. Oxidation@M;Phospho@S.
    mod_set (set): mod set to check
Returns:
    str: original <code>mod_str</code> if all modifications are in mod_set
         else pd.NA.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="PSMReaderBase">PSMReaderBase<a class="anchor-link" href="#PSMReaderBase"> </a></h2><p><a href="/alphabase/psm_reader.html#PSMReaderBase"><code>PSMReaderBase</code></a> is the base abstract class for all readers. It defines the basic procedures for importing other search engine results into AlphaBase format.</p>
<p>The main entry method is <code>import_file(filename)</code>, and it will generate <code>self._psm_df</code> (or property <code>self.psm_df</code>) after <code>import_file()</code>.</p>
<p>In <code>import_file()</code> method, we designed five steps to load result files in to AlphaBase format:</p>
<ol>
<li><p><code>origin_df = self._load_file(filename)</code>. We load result files into a dataframe without doing any file conversion. As different search engines have different file format, some of them are not in the tabular format. <strong>All subclass of <a href="/alphabase/psm_reader.html#PSMReaderBase"><code>PSMReaderBase</code></a> need to re-implement this method</strong>.</p>
</li>
<li><p><code>self._translate_columns(origin_df)</code>. We translate columns in <code>origin_df</code> into AlphaBase columns by <code>self.column_mapping</code>. <code>self.column_mapping</code> provides a flexible way for developers to extract their required columns.</p>
</li>
<li><p><code>self._load_modifications(origin_df)</code>. As different search engines have different representation of modifications. We use this method to extract the modifications into <code>self._psm_df['mods']</code> and <code>self._psm_df['mod_sites']</code>. Note that the modification names are still in other search engines' format. <strong>All subclass of <a href="/alphabase/psm_reader.html#PSMReaderBase"><code>PSMReaderBase</code></a> need to re-implement this method</strong>.</p>
</li>
<li><p><code>self._translate_modifications()</code>. Convert modification names into AlphaBase names (<code>unimod_name@AA</code>). For most of the search engines, we need a dict (<code>self.modification_mapping</code>) to map search engine modification format into AlphaBase (<code>unimod_name@AA</code>, <code>unimod_name</code> is &lt;umod:mod title=...&gt; in the unimod xml file). <strong>All subclass of <a href="/alphabase/psm_reader.html#PSMReaderBase"><code>PSMReaderBase</code></a> need to re-implement this method</strong>.</p>
</li>
<li><p><code>self._post_process(filename, origin_df)</code>. Any required post-processing steps. For example, we remove unknown modifications here.</p>
</li>
</ol>
<h3 id="Other-results-must-be-converted-into-the-alphabase-dataframe-with-required-columns:">Other results must be converted into the alphabase dataframe with required columns:<a class="anchor-link" href="#Other-results-must-be-converted-into-the-alphabase-dataframe-with-required-columns:"> </a></h3><ol>
<li><code>sequence</code> (str): AA sequence, for example, 'ATMYPEDR'.</li>
<li><code>mods</code> (str): modification names, separated by ';'. For example, 'Oxidation@M', 'Acetyl@Protein N-term;Oxidation@M'.</li>
<li><code>mod_sites</code> (str): modification sites, seperated by ';'. For example, '3', '0;3'. The N-term site is 0, and the C-term site is -1, and all other modification sites start from 1.</li>
<li><code>nAA</code> (int): number of AA in the sequence, could be set by <code>df['nAA']=df.sequence.str.len()</code>.</li>
<li><code>charge</code> (int): precursor charge states.</li>
<li><code>rt</code> (float): retention time (RT) of peptides, in minutes by default.</li>
<li><code>rt_norm</code> (float): RT normalized by the maximum value, could be set by <code>df['rt_norm'] = df.rt/df.rt.max()</code>.
### and optional columns:</li>
<li><code>ccs</code> (float): collisional cross section (CCS) value, requred for IM data.</li>
<li><code>mobility</code> (float): precursor ion mobility value, requred for IM data.</li>
<li><code>precursor_mz</code> (float): precursor m/z value.</li>
<li><code>proteins</code> (str): protein names, separated by ';'.</li>
<li><code>genes</code> (str): gene names, separated by ';'.</li>
<li><code>protein_ids</code> (str): protein ids or uniprot ids, separated by ';'.</li>
<li><code>score</code> (float): PSM score. The larger the better PSMs, meaning that <code>E-value</code> or <code>P-value</code> scores must be <code>-log()</code>.</li>
<li><code>fdr</code> (float): FDR or q-value.</li>
<li><code>raw_name</code> (str): Raw file name.</li>
<li><code>spec_idx</code> (int): spectrum index starting from 0 in RAW data. For thermo RAW, it is also Scan number - 1. We can use it to locate the MS2 spectrum for identification.</li>
<li><code>query_id</code> (int or str): the unique id for not only inlucdes unique spectrum (<code>spec_idx</code>), but also the precursor or MS1 isotope index. It could be <code>query_idx</code> in alphapept.</li>
<li><code>decoy</code>: 0 if the peptide is target match, otherwise 1.</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PSMReaderBase" class="doc_header"><code>class</code> <code>PSMReaderBase</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/io/psm_reader/psm_reader.py#L82" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PSMReaderBase</code>(<strong><code>column_mapping</code></strong>:<code>dict</code>=<em><code>None</code></em>, <strong><code>modification_mapping</code></strong>:<code>dict</code>=<em><code>None</code></em>, <strong><code>fdr</code></strong>=<em><code>0.01</code></em>, <strong><code>keep_decoy</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="PSMReaderProvider">PSMReaderProvider<a class="anchor-link" href="#PSMReaderProvider"> </a></h1><p>To make it easier to create different readers, we design a <code>Provider</code> or <code>Factory</code> called <a href="/alphabase/psm_reader.html#PSMReaderProvider"><code>PSMReaderProvider</code></a> to manage all reader classes. <a href="/alphabase/psm_reader.html#PSMReaderProvider"><code>PSMReaderProvider</code></a> is instantiated as a global object <a href="/alphabase/psm_reader.html#psm_reader_provider"><code>psm_reader_provider</code></a>.</p>
<p>After a subclass of <a href="/alphabase/psm_reader.html#PSMReaderBase"><code>PSMReaderBase</code></a> is defined, for example <a href="/alphabase/alphapept_reader.html#AlphaPeptReader"><code>AlphaPeptReader</code></a>, we can then register it in to <a href="/alphabase/psm_reader.html#psm_reader_provider"><code>psm_reader_provider</code></a> by using <a href="/alphabase/psm_reader.html#psm_reader_provider.register_reader(&#39;alphapept&#39;, AlphaPeptReader"><code>psm_reader_provider.register_reader('alphapept', AlphaPeptReader)</code></a>). Once we are going to use it, we just need to create a <a href="/alphabase/alphapept_reader.html#AlphaPeptReader"><code>AlphaPeptReader</code></a> object with <a href="/alphabase/psm_reader.html#psm_reader_provider.get_reader(&#39;alphapept&#39;"><code>psm_reader_provider.get_reader('alphapept')</code></a>).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PSMReaderProvider" class="doc_header"><code>class</code> <code>PSMReaderProvider</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/io/psm_reader/psm_reader.py#L417" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PSMReaderProvider</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As we have loaded all readers in <a href="/alphabase/psm_reader.html#psm_reader_provider"><code>psm_reader_provider</code></a> within alphabase.io.psm_reader.__init__.py, we can easily access all registered readers by <a href="/alphabase/psm_reader.html#psm_reader_provider"><code>psm_reader_provider</code></a>.</p>

</div>
</div>
</div>
</div>
 

