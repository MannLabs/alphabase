---

title: Mass calculation functions for fragments


keywords: fastai
sidebar: home_sidebar



nb_path: "nbdev_nbs/peptide/mass_calc.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbdev_nbs/peptide/mass_calc.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_delta_modification_mass" class="doc_header"><code>calc_delta_modification_mass</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/mass_calc.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_delta_modification_mass</code>(<strong><code>pep_len</code></strong>:<code>int</code>, <strong><code>mass_deltas</code></strong>:<code>List</code>[<code>float</code>], <strong><code>mass_delta_sites</code></strong>:<code>List</code>[<code>int</code>])</p>
</blockquote>
<p>For open-search, we may also get modification
mass deltas other than mod names. This function calculate
modification masses from these delta masses.</p>
<p>Args:
    pep_len (int): nAA
    mass_deltas (list of floats): mass deltas on the peptide
    mass_delta_sites (list of int): localized sites of corresponding mass deltas</p>
<p>Returns:
    np.array: 1-D array with length=<code>peplen</code>.
        Masses of modifications (mass deltas) through the peptide,
        <code>0</code> if sites has no modifications</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_mod_delta_masses_for_same_len_seqs" class="doc_header"><code>calc_mod_delta_masses_for_same_len_seqs</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/mass_calc.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_mod_delta_masses_for_same_len_seqs</code>(<strong><code>nAA</code></strong>:<code>int</code>, <strong><code>mod_deltas_list</code></strong>:<code>List</code>[<code>List</code>[<code>float</code>]], <strong><code>mod_sites_list</code></strong>:<code>List</code>[<code>List</code>[<code>int</code>]])</p>
</blockquote>
<p>Calculate delta modification masses for the given peptide length (<code>nAA</code>),
For open-search, we may also get modification
mass deltas other than mod names. This function calculate
modification masses from these delta masses.</p>
<p>Args:
    nAA (int): peptide length
    mod_names_list (List[List[str]]): list of modification list
    mod_sites_list (List[List[int]]): list of modification site list corresponding
        to <code>mod_names_list</code>.</p>

<pre><code>    * `site=0` refers to an N-term modification
    * `site=-1` refers to a C-term modification
    * `1&lt;=site&lt;=peplen` refers to a normal modification

</code></pre>
<p>Returns:
    np.array: 2-D array with shape=<code>(nAA, pep_count or len(mod_names_list)))</code>.
        Masses of modifications through all the peptides,
        <code>0</code> if sites has no modifications</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_b_y_and_peptide_mass" class="doc_header"><code>calc_b_y_and_peptide_mass</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/mass_calc.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_b_y_and_peptide_mass</code>(<strong><code>sequence</code></strong>:<code>str</code>, <strong><code>mod_names</code></strong>:<code>List</code>[<code>str</code>], <strong><code>mod_sites</code></strong>:<code>List</code>[<code>int</code>], <strong><code>mod_deltas</code></strong>:<code>List</code>[<code>float</code>]=<em><code>None</code></em>, <strong><code>mod_delta_sites</code></strong>:<code>List</code>[<code>int</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>It is highly recommend to use
<code>calc_b_y_and_peptide_masses_for_same_len_seqs()</code>
as it is much faster</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="calc_peptide_masses_for_same_len_seqs()-and-calc_b_y_and_peptide_masses_for_same_len_seqs()-are-key-functions-for-mass-calculation-in-this-module."><code>calc_peptide_masses_for_same_len_seqs()</code> and <code>calc_b_y_and_peptide_masses_for_same_len_seqs()</code> are key functions for mass calculation in this module.<a class="anchor-link" href="#calc_peptide_masses_for_same_len_seqs()-and-calc_b_y_and_peptide_masses_for_same_len_seqs()-are-key-functions-for-mass-calculation-in-this-module."> </a></h3><p><code>calc_peptide_masses_for_same_len_seqs()</code> calculates the peptide masses for the given sequence array and modification lists.</p>
<p><code>calc_b_y_and_peptide_masses_for_same_len_seqs()</code> calculates b/y neutral masses and peptide masses for the given sequence array and modification lists. Note that all a/b/c neutral masses can be calculated from b fragment masses, and x/y/z from y masses. So the key are b/y masses.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_peptide_masses_for_same_len_seqs" class="doc_header"><code>calc_peptide_masses_for_same_len_seqs</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/mass_calc.py#L122" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_peptide_masses_for_same_len_seqs</code>(<strong><code>sequences</code></strong>:<code>array</code>, <strong><code>mod_list</code></strong>:<code>List</code>[<code>str</code>], <strong><code>mod_delta_list</code></strong>:<code>List</code>[<code>str</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Calculate peptide masses for peptide sequences with same lengths.
We need 'same_len' here because numpy can process AA sequences
with same length very fast.
See <code>alphabase.aa.calc_sequence_masses_for_same_len_seqs()</code></p>
<p>Args:
    mod_list (List[str]): list of modifications,
        e.g. <code>['Oxidation@M;Phospho@S','Phospho@S;Deamidated@N']</code>
    mass_delta_list (List[str]): List of modifications as mass deltas,
        e.g. <code>['15.9xx;79.9xxx','79.9xx;0.98xx']</code></p>
<p>Returns:
    np.array: peptide masses (1-D array, H2O already added)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_b_y_and_peptide_masses_for_same_len_seqs" class="doc_header"><code>calc_b_y_and_peptide_masses_for_same_len_seqs</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/mass_calc.py#L160" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_b_y_and_peptide_masses_for_same_len_seqs</code>(<strong><code>sequences</code></strong>:<code>array</code>, <strong><code>mod_list</code></strong>:<code>List</code>[<code>List</code>[<code>str</code>]], <strong><code>site_list</code></strong>:<code>List</code>[<code>List</code>[<code>int</code>]], <strong><code>mod_delta_list</code></strong>:<code>List</code>[<code>List</code>[<code>float</code>]]=<em><code>None</code></em>, <strong><code>mod_delta_site_list</code></strong>:<code>List</code>[<code>List</code>[<code>int</code>]]=<em><code>None</code></em>)</p>
</blockquote>
<p>Calculate b/y fragment masses and peptide masses
for peptide sequences with same lengths.
We need 'same_len' here because numpy can process AA sequences
with same length very fast.</p>
<p>Args:
    sequence (np.array of str): np.array of peptie sequences with same length.
    mod_list (List[List[str]]): list of modifications ,
        e.g. <code>[['Oxidation@M','Phospho@S'],['Phospho@S','Deamidated@N']]</code>
    site_list (List[List[int]]): list of modification sites
        corresponding to <code>mod_list</code>, e.g. <code>[[3,6],[4,17]]</code>
    mod_delta_list (List[List[float]]): list of modifications,
        e.g. <code>[[15.994915,79.966331],[79.966331,0.984016]]</code>
    mod_delta_site_list (List[List[int]]): list of modification mass delta sites
        corresponding to <code>mod_list</code>, e.g. <code>[[3,6],[4,17]]</code></p>
<p>Returns:
    np.array: neutral b fragment masses (2-D array)
    np.array: neutral y fragmnet masses (2-D array)
    np.array: neutral peptide masses (1-D array)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="p">,</span> <span class="n">mod_sites</span> <span class="o">=</span> <span class="s1">&#39;AGHCEWQMK&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Carbamidomethyl@C&#39;</span><span class="p">,</span> <span class="s1">&#39;Oxidation@M&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">b</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">pepmass</span> <span class="o">=</span> <span class="n">calc_b_y_and_peptide_mass</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="p">,</span> <span class="n">mod_sites</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span>  <span class="mf">71.03711379</span><span class="p">,</span>  <span class="mf">128.05857751</span><span class="p">,</span>  <span class="mf">265.11748936</span><span class="p">,</span>  <span class="mf">425.14813804</span><span class="p">,</span>
         <span class="mf">554.19073113</span><span class="p">,</span>  <span class="mf">740.27004408</span><span class="p">,</span>  <span class="mf">868.32862159</span><span class="p">,</span> <span class="mf">1015.3640213</span> <span class="p">]</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span>  <span class="p">[</span><span class="mf">1090.43243521</span><span class="p">,</span> <span class="mf">1033.41097149</span><span class="p">,</span>  <span class="mf">896.35205963</span><span class="p">,</span>  <span class="mf">736.32141095</span><span class="p">,</span>
         <span class="mf">607.27881786</span><span class="p">,</span>  <span class="mf">421.19950491</span><span class="p">,</span>  <span class="mf">293.14092741</span><span class="p">,</span>  <span class="mf">146.1055277</span> <span class="p">]</span> <span class="p">]</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">pepmass</span><span class="p">,</span> <span class="mf">1161.46954899713</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b_frags</span><span class="p">,</span><span class="n">y_frags</span><span class="p">,</span><span class="n">pepmasses</span><span class="o">=</span><span class="n">calc_b_y_and_peptide_masses_for_same_len_seqs</span><span class="p">([</span><span class="n">seq</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">mods</span><span class="p">,[]],</span> <span class="p">[</span><span class="n">mod_sites</span><span class="p">,[]])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">b_frags</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span>  <span class="mf">71.03711379</span><span class="p">,</span>  <span class="mf">128.05857751</span><span class="p">,</span>  <span class="mf">265.11748936</span><span class="p">,</span>  <span class="mf">425.14813804</span><span class="p">,</span>
         <span class="mf">554.19073113</span><span class="p">,</span>  <span class="mf">740.27004408</span><span class="p">,</span>  <span class="mf">868.32862159</span><span class="p">,</span> <span class="mf">1015.3640213</span> <span class="p">]</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">y_frags</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span>  <span class="p">[</span><span class="mf">1090.43243521</span><span class="p">,</span> <span class="mf">1033.41097149</span><span class="p">,</span>  <span class="mf">896.35205963</span><span class="p">,</span>  <span class="mf">736.32141095</span><span class="p">,</span>
         <span class="mf">607.27881786</span><span class="p">,</span>  <span class="mf">421.19950491</span><span class="p">,</span>  <span class="mf">293.14092741</span><span class="p">,</span>  <span class="mf">146.1055277</span> <span class="p">]</span> <span class="p">]</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">pepmasses</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1161.46954899713</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">calc_peptide_masses_for_same_len_seqs</span><span class="p">([</span><span class="n">seq</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mods</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">]),</span> <span class="p">[</span><span class="mf">1161.469549</span>  <span class="p">,</span> <span class="mf">1088.45317066</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

