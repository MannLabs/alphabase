---

title: Isotope distribution (in centroid mode)


keywords: fastai
sidebar: home_sidebar



nb_path: "nbdev_nbs/constants/isotope.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbdev_nbs/constants/isotope.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="abundance_convolution" class="doc_header"><code>abundance_convolution</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/constants/isotope.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>abundance_convolution</code>(<strong><code>d1</code></strong>:<code>array</code>, <strong><code>mono1</code></strong>:<code>int</code>, <strong><code>d2</code></strong>:<code>array</code>, <strong><code>mono2</code></strong>:<code>int</code>)</p>
</blockquote>
<p>If we have two isotope distributions,
we can convolute them into one distribution.</p>
<p>Args:
    d1 (np.array): isotope distribution to convolute.
    mono1 (int): mono position of d1.
    d2 (np.array): isotope distribution to convolute.
    mono2 (int): mono position of d2</p>
<p>Returns:
    np.array: convoluted isotope distribution.
    int: new mono position.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a given chemical formula, e.g. <code>H(100)O(50)N(20)</code>, we first calculate the isotope distribution using "binary search"-like method for each type of element (here are <code>H(100)</code>, <code>O(50)</code> and <code>N(20)</code>) (see <code>one_element_dist()</code>). And then we convolute these distributions of all types into one distribution (see <code>formula_dist()</code>).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="one_element_dist" class="doc_header"><code>one_element_dist</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/constants/isotope.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>one_element_dist</code>(<strong><code>elem</code></strong>:<code>str</code>, <strong><code>n</code></strong>:<code>int</code>, <strong><code>chem_isotope_dist</code></strong>:<code>Dict</code>, <strong><code>chem_mono_idx</code></strong>:<code>Dict</code>)</p>
</blockquote>
<p>Calculate the isotope distribution for
an element and its numbers.</p>
<p>Args:
    elem (str): element.
    n (int): element number.
    chem_isotope_dist (numba.typed.Dict): use <a href="/alphabase/element.html#CHEM_ISOTOPE_DIST"><code>CHEM_ISOTOPE_DIST</code></a> as parameter.
    chem_mono_idx (numba.typed.Dict): use <a href="/alphabase/element.html#CHEM_MONO_IDX"><code>CHEM_MONO_IDX</code></a> as parameter.</p>
<p>Returns:
    np.array: isotope distribution of the element.
    int: mono position in the distribution</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="formula_dist" class="doc_header"><code>formula_dist</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/constants/isotope.py#L78" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>formula_dist</code>(<strong><code>formula</code></strong>:<code>Union</code>[<code>list</code>, <code>str</code>])</p>
</blockquote>
<p>Generate the isotope distribution and the mono index for
a given formula (as a list, e.g. <code>[('H', 2), ('C', 2), ('O', 1)]</code>).</p>
<p>Args:
    formula (typing.Union[list, str]): chemical formula, could be str or list.
        If str: "H(1)N(2)O(3)".
        If list: "[('H',1),('H',2),('H',3)]".</p>
<p>Returns:
    np.array: isotope distribution
    int: mono position</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Compare calculated isotope distributions with sisweb.com/mstools/isotope.htm</p>
<p>Desired distribution for H10: (100, 0.16, 0.0001) calculated from sisweb.com/mstools/isotope.htm in low resolution mode (centroid mode)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Desired distribution for <code>C(100)H(100)O(10)</code>: <code>(90.7784, 100, 56.368, 21.6475, 6.3624, 1.524, 0.3093)</code> calculated from sisweb.com/mstools/isotope.htm in low resolution mode (centroid mode)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-target-and-calculated-distributions-are-very-similar">The target and calculated distributions are very similar<a class="anchor-link" href="#The-target-and-calculated-distributions-are-very-similar"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Compare-with-Averagine">Compare with Averagine<a class="anchor-link" href="#Compare-with-Averagine"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test for heavy labeled formula</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="IsotopeDistribution">IsotopeDistribution<a class="anchor-link" href="#IsotopeDistribution"> </a></h1><p><code>formula_dist()</code> always calculates the distribution of each element based on the element number (using binary-search-like operation) and convolute distributions of different elements. If we have many peptides to calculate, each element's distribution will be calculated repeatly. In <a href="/alphabase/isotope.html#IsotopeDistribution"><code>IsotopeDistribution</code></a>, instead of generating on-the-fly, we pre-built the isotope distribution table for each of the most common elements (C,H,N,O,S,P) with the element number from 0 to N, and N is large enough to cover all composition in shotgun proteomics. Thus, for a given chemical formula, we just need to check the distribution table for each element and convolute distributions among different elements.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="IsotopeDistribution" class="doc_header"><code>class</code> <code>IsotopeDistribution</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/constants/isotope.py#L130" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>IsotopeDistribution</code>(<strong><code>max_elem_num_dict</code></strong>:<code>dict</code>=<em><code>{'C': 2000, 'H': 5000, 'N': 1000, 'O': 1000, 'S': 200, 'P': 200}</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dist</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([1.92320044e-02, 2.10952666e-02, 3.13753566e-01, 3.42663681e-01,
       1.95962632e-01, 7.69157517e-02, 2.31993814e-02, 5.71948249e-03,
       1.19790438e-03, 2.18815385e-04])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iso</span> <span class="o">=</span> <span class="n">IsotopeDistribution</span><span class="p">()</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;C(100)H(100)O(10)Na(1)&#39;</span>
<span class="n">formula</span> <span class="o">=</span> <span class="n">parse_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
<span class="n">dist</span><span class="p">,</span> <span class="n">mono</span> <span class="o">=</span> <span class="n">iso</span><span class="o">.</span><span class="n">calc_formula_distribution</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
<span class="n">dist1</span><span class="p">,</span> <span class="n">mono1</span> <span class="o">=</span> <span class="n">formula_dist</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">dist1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">mono</span><span class="o">==</span><span class="n">mono1</span>
<span class="k">assert</span> <span class="n">mono</span><span class="o">==</span><span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

