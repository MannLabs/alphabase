---

title: Precursor (peptide+charge) functionalities


keywords: fastai
sidebar: home_sidebar



nb_path: "nbdev_nbs/peptide/precursor.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbdev_nbs/peptide/precursor.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="refine_precursor_df" class="doc_header"><code>refine_precursor_df</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>refine_precursor_df</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>drop_frag_idx</code></strong>=<em><code>True</code></em>, <strong><code>ensure_data_validity</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Refine df inplace for faster precursor/fragment calculation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_precursor_refined" class="doc_header"><code>is_precursor_refined</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_precursor_refined</code>(<strong><code>precursor_df</code></strong>:<code>DataFrame</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_precursor_mz" class="doc_header"><code>update_precursor_mz</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L74" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_precursor_mz</code>(<strong><code>precursor_df</code></strong>:<code>DataFrame</code>, <strong><code>batch_size</code></strong>=<em><code>500000</code></em>)</p>
</blockquote>
<p>Calculate precursor_mz inplace in the precursor_df</p>
<p>Args:
    precursor_df (pd.DataFrame):
      precursor_df with the 'charge' column</p>
<p>Returns:
    pd.DataFrame: precursor_df with 'precursor_mz'</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mod_seq_hash" class="doc_header"><code>get_mod_seq_hash</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mod_seq_hash</code>(<strong><code>sequence</code></strong>:<code>str</code>, <strong><code>mods</code></strong>:<code>str</code>, <strong><code>mod_sites</code></strong>:<code>str</code>, <strong><code>seed</code></strong>:<code>int</code>=<em><code>0</code></em>)</p>
</blockquote>
<p>Get hash code value for a peptide:
  (sequence, mods, mod_sites)</p>
<p>Args:
    sequence (str): amino acid sequence
    mods (str): modification names in AlphaBase format
    mod_sites (str): modification sites in AlphaBase format
    seed (int, optional): seed for hashing
      Defaults to 0.</p>
<p>Returns:
    np.int64: 64-bit hash code value</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mod_seq_charge_hash" class="doc_header"><code>get_mod_seq_charge_hash</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L153" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mod_seq_charge_hash</code>(<strong><code>sequence</code></strong>:<code>str</code>, <strong><code>mods</code></strong>:<code>str</code>, <strong><code>mod_sites</code></strong>:<code>str</code>, <strong><code>charge</code></strong>:<code>int</code>, <strong><code>seed</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Get hash code value for a precursor:
  (sequence, mods, mod_sites, charge)</p>
<p>Args:
    sequence (str): amino acid sequence
    mods (str): modification names in AlphaBase format
    mod_sites (str): modification sites in AlphaBase format
    charge (int): precursor charge state
    seed (int, optional): seed for hashing
      Defaults to 0.</p>
<p>Returns:
    np.int64: 64-bit hash code value</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hash_mod_seq_df" class="doc_header"><code>hash_mod_seq_df</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L180" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hash_mod_seq_df</code>(<strong><code>precursor_df</code></strong>:<code>DataFrame</code>, <strong><code>seed</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Internal function</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hash_mod_seq_charge_df" class="doc_header"><code>hash_mod_seq_charge_df</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L200" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hash_mod_seq_charge_df</code>(<strong><code>precursor_df</code></strong>:<code>DataFrame</code>, <strong><code>seed</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Internal function</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hash_precursor_df" class="doc_header"><code>hash_precursor_df</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L218" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hash_precursor_df</code>(<strong><code>precursor_df</code></strong>:<code>DataFrame</code>, <strong><code>seed</code></strong>:<code>int</code>=<em><code>0</code></em>)</p>
</blockquote>
<p>Add columns 'mod_seq_hash' and 'mod_seq_charge_hash'
into precursor_df (inplace).
The 64-bit hash function is from mmh3 (mmh3.hash64).</p>
<p>Args:
    precursor_df (pd.DataFrame): precursor_df
    seed (int, optional): seed for mmh3.hash64.
      Defaults to 0</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mod_seq_formula" class="doc_header"><code>get_mod_seq_formula</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L238" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mod_seq_formula</code>(<strong><code>seq</code></strong>:<code>str</code>, <strong><code>mods</code></strong>:<code>str</code>)</p>
</blockquote>
<p>'PEPTIDE','Acetyl@Any N-term' --&gt; [('C',n), ('H',m), ...]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mod_seq_isotope_distribution" class="doc_header"><code>get_mod_seq_isotope_distribution</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L258" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mod_seq_isotope_distribution</code>(<strong><code>seq_mods</code></strong>:<code>tuple</code>, <strong><code>isotope_dist</code></strong>:<a href="/alphabase/isotope.html#IsotopeDistribution"><code>IsotopeDistribution</code></a>)</p>
</blockquote>
<p>Get isotope abundance distribution by IsotopeDistribution.
This function is designed for multiprocessing.</p>
<p>Args:
    seq_mods (tuple): (sequence, mods)
    isotope_dist (IsotopeDistribution):
        see :class:<code>alphabase.constants.isotope.IsotopeDistribution</code></p>
<p>Returns:
    float: abundance of mono+1 / mono
    float: abundance of mono+2 / mono
    float: abundance of apex / mono
    int: Apex isotope position relative to mono,
         i.e. apex index - mono index and
         0 refers to the position of mono itself.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_precursor_isotope" class="doc_header"><code>calc_precursor_isotope</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L291" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_precursor_isotope</code>(<strong><code>precursor_df</code></strong>:<code>DataFrame</code>)</p>
</blockquote>
<p>Calculate isotope mz values and relative (to M0) intensity values for precursor_df inplace.</p>
<p>Args:
    precursor_df (pd.DataFrame): precursor_df to calculate.</p>
<p>Returns:
    pd.DataFrame: precursor_df with additional columns:</p>

<pre><code>- isotope_intensity_m1
- isotope_mz_m1
- isotope_intensity_m2
- isotope_mz_m2
- isotope_apex_intensity
- isotope_apex_mz
- isotope_apex_index</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_precursor_isotope_mp" class="doc_header"><code>calc_precursor_isotope_mp</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/peptide/precursor.py#L364" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_precursor_isotope_mp</code>(<strong><code>precursor_df</code></strong>:<code>DataFrame</code>, <strong><code>processes</code></strong>:<code>int</code>=<em><code>8</code></em>, <strong><code>mp_batch_size</code></strong>:<code>int</code>=<em><code>100000</code></em>, <strong><code>process_bar</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p><code>calc_precursor_isotope()</code> is not that fast for large dataframes,
so here we use multiprocessing for faster isotope pattern calculation.
The speed is acceptable with multiprocessing (3.8 min for 21M precursors, 8 processes).</p>
<p>Args:
    precursor_df (pd.DataFrame): precursor_df to calculate.
    processes (int, optional): process number. Defaults to 8.
    mp_batch_size (int, optional): multiprocessing batch size. Defaults to 100000.
    process_bar (function, optional): The tqdm-based callback function
    to check multiprocessing. Defaults to None.</p>
<p>Returns:
    pd.DataFrame: precursor_df with additional columns:</p>

<pre><code>- isotope_intensity_m1
- isotope_mz_m1
- isotope_intensity_m2
- isotope_mz_m2
- isotope_apex_intensity
- isotope_apex_mz
- isotope_apex_index</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">peptides</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AGHCEWQMKAADER&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">mods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Acetyl@Protein N-term;Carbamidomethyl@C;Oxidation@M&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">sites</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0;4;8&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">peptides</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;AGHCEWQMK&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">mods</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">sites</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>

<span class="n">precursor_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="n">peptides</span><span class="p">,</span>
    <span class="s1">&#39;mods&#39;</span><span class="p">:</span> <span class="n">mods</span><span class="p">,</span>
    <span class="s1">&#39;mod_sites&#39;</span><span class="p">:</span> <span class="n">sites</span>
<span class="p">})</span>
<span class="n">precursor_df</span><span class="p">[</span><span class="s1">&#39;nAA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precursor_df</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
<span class="n">precursor_df</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

