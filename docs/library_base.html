---

title: Base structure of spectral libraries


keywords: fastai
sidebar: home_sidebar



nb_path: "nbdev_nbs/spectral_library/library_base.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbdev_nbs/spectral_library/library_base.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SpecLibBase" class="doc_header"><code>class</code> <code>SpecLibBase</code><a href="https://github.com/MannLabs/alphabase/tree/main/alphabase/spectral_library/library_base.py#L16" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SpecLibBase</code>(<strong><code>charged_frag_types</code></strong>:<code>List</code>[<code>str</code>]=<em><code>['b_z1', 'b_z2', 'y_z1', 'y_z2']</code></em>, <strong><code>precursor_mz_min</code></strong>=<em><code>400</code></em>, <strong><code>precursor_mz_max</code></strong>=<em><code>6000</code></em>, <strong><code>decoy</code></strong>:<code>str</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">repeat</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">peptides</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AGHCEWQMK&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">mods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Acetyl@Protein N-term;Carbamidomethyl@C;Oxidation@M&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">sites</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0;4;8&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">peptides</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;AGHCEWQMKAADER&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">mods</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>
<span class="n">sites</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span>

<span class="n">precursor_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="n">peptides</span><span class="p">,</span>
    <span class="s1">&#39;mods&#39;</span><span class="p">:</span> <span class="n">mods</span><span class="p">,</span>
    <span class="s1">&#39;mod_sites&#39;</span><span class="p">:</span> <span class="n">sites</span>
<span class="p">})</span>
<span class="n">precursor_df</span><span class="p">[</span><span class="s1">&#39;nAA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precursor_df</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
<span class="n">precursor_df</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">target_lib</span> <span class="o">=</span> <span class="n">SpecLibBase</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;b_z1&#39;</span><span class="p">,</span><span class="s1">&#39;b_z2&#39;</span><span class="p">,</span><span class="s1">&#39;y_z1&#39;</span><span class="p">,</span><span class="s1">&#39;y_z2&#39;</span><span class="p">],</span>
    <span class="n">decoy</span><span class="o">=</span><span class="s1">&#39;pseudo_reverse&#39;</span>
<span class="p">)</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">_precursor_df</span> <span class="o">=</span> <span class="n">precursor_df</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">calc_precursor_mz</span><span class="p">()</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">_fragment_mz_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">_fragment_intensity_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;sandbox&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;sandbox&#39;</span><span class="p">)</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">save_hdf</span><span class="p">(</span><span class="s1">&#39;sandbox/test_lib.hdf&#39;</span><span class="p">)</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">save_df_to_hdf</span><span class="p">(</span><span class="s1">&#39;sandbox/test_lib.hdf&#39;</span><span class="p">,</span><span class="s1">&#39;protein_df&#39;</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">})</span>
<span class="p">)</span>
<span class="n">new_lib</span> <span class="o">=</span> <span class="n">SpecLibBase</span><span class="p">([])</span>
<span class="n">new_lib</span><span class="o">.</span><span class="n">load_hdf</span><span class="p">(</span><span class="s1">&#39;sandbox/test_lib.hdf&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_lib</span><span class="o">.</span><span class="n">precursor_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_lib</span><span class="o">.</span><span class="n">fragment_mz_df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_lib</span><span class="o">.</span><span class="n">fragment_intensity_df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="k">assert</span> <span class="s1">&#39;sequence&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_lib</span><span class="o">.</span><span class="n">precursor_df</span><span class="o">.</span><span class="n">columns</span>
<span class="k">assert</span> <span class="s1">&#39;mod_seq_hash&#39;</span> <span class="ow">in</span> <span class="n">new_lib</span><span class="o">.</span><span class="n">precursor_df</span><span class="o">.</span><span class="n">columns</span>


<span class="n">new_lib</span> <span class="o">=</span> <span class="n">SpecLibBase</span><span class="p">([])</span>
<span class="n">new_lib</span><span class="o">.</span><span class="n">load_hdf</span><span class="p">(</span><span class="s1">&#39;sandbox/test_lib.hdf&#39;</span><span class="p">,</span> <span class="n">load_mod_seq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;sequence&#39;</span> <span class="ow">in</span> <span class="n">new_lib</span><span class="o">.</span><span class="n">precursor_df</span><span class="o">.</span><span class="n">columns</span>
<span class="k">assert</span> <span class="s1">&#39;mod_seq_hash&#39;</span> <span class="ow">in</span> <span class="n">new_lib</span><span class="o">.</span><span class="n">precursor_df</span><span class="o">.</span><span class="n">columns</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">target_lib</span><span class="o">.</span><span class="n">load_df_from_hdf</span><span class="p">(</span><span class="s1">&#39;sandbox/test_lib.hdf&#39;</span><span class="p">,</span> <span class="s1">&#39;precursor_df&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">precursor_df</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">target_lib</span><span class="o">.</span><span class="n">load_df_from_hdf</span><span class="p">(</span><span class="s1">&#39;sandbox/test_lib.hdf&#39;</span><span class="p">,</span> <span class="s1">&#39;protein_df&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;sandbox/test_lib.hdf&#39;</span><span class="p">)</span>
<span class="n">precursor_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sequence</th>
      <th>mods</th>
      <th>mod_sites</th>
      <th>nAA</th>
      <th>charge</th>
      <th>precursor_mz</th>
      <th>mod_seq_hash</th>
      <th>mod_seq_charge_hash</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AGHCEWQMK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AGHCEWQMK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AGHCEWQMK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AGHCEWQMKAADER</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AGHCEWQMKAADER</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
    </tr>
    <tr>
      <th>5</th>
      <td>AGHCEWQMKAADER</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target_lib</span><span class="o">.</span><span class="n">append_decoy_sequence</span><span class="p">()</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_lib</span><span class="o">.</span><span class="n">precursor_df</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">precursor_df</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">precursor_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sequence</th>
      <th>mods</th>
      <th>mod_sites</th>
      <th>nAA</th>
      <th>charge</th>
      <th>precursor_mz</th>
      <th>mod_seq_hash</th>
      <th>mod_seq_charge_hash</th>
      <th>decoy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AGHCEWQMK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AGHCEWQMK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AGHCEWQMK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MQWECHGAK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>MQWECHGAK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MQWECHGAK</td>
      <td>Acetyl@Protein N-term;Carbamidomethyl@C;Oxidat...</td>
      <td>0;4;8</td>
      <td>9</td>
      <td>2</td>
      <td>602.747333</td>
      <td>-5783464648586361190</td>
      <td>-5783464648586361188</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AGHCEWQMKAADER</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AGHCEWQMKAADER</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>AGHCEWQMKAADER</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>EDAAKMQWECHGAR</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>EDAAKMQWECHGAR</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>EDAAKMQWECHGAR</td>
      <td></td>
      <td></td>
      <td>14</td>
      <td>2</td>
      <td>816.356299</td>
      <td>-1606275412423975023</td>
      <td>-1606275412423975021</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target_lib</span><span class="o">.</span><span class="n">calc_fragment_mz_df</span><span class="p">()</span>
<span class="k">assert</span> <span class="s1">&#39;b_z1&#39;</span> <span class="ow">in</span> <span class="n">target_lib</span><span class="o">.</span><span class="n">fragment_mz_df</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_lib</span><span class="o">.</span><span class="n">fragment_mz_df</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">target_lib</span><span class="o">.</span><span class="n">precursor_df</span><span class="o">.</span><span class="n">nAA</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">target_lib</span><span class="o">.</span><span class="n">fragment_mz_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>b_z1</th>
      <th>b_z2</th>
      <th>y_z1</th>
      <th>y_z2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>114.054955</td>
      <td>57.531116</td>
      <td>1091.439712</td>
      <td>546.223494</td>
    </tr>
    <tr>
      <th>1</th>
      <td>171.076419</td>
      <td>86.041848</td>
      <td>1034.418248</td>
      <td>517.712762</td>
    </tr>
    <tr>
      <th>2</th>
      <td>308.135331</td>
      <td>154.571303</td>
      <td>897.359336</td>
      <td>449.183306</td>
    </tr>
    <tr>
      <th>3</th>
      <td>468.165979</td>
      <td>234.586628</td>
      <td>737.328687</td>
      <td>369.167982</td>
    </tr>
    <tr>
      <th>4</th>
      <td>597.208572</td>
      <td>299.107924</td>
      <td>608.286094</td>
      <td>304.646685</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>121</th>
      <td>1089.466972</td>
      <td>545.237124</td>
      <td>543.245626</td>
      <td>272.126451</td>
    </tr>
    <tr>
      <th>122</th>
      <td>1192.476157</td>
      <td>596.741717</td>
      <td>440.236442</td>
      <td>220.621859</td>
    </tr>
    <tr>
      <th>123</th>
      <td>1329.535069</td>
      <td>665.271173</td>
      <td>303.177530</td>
      <td>152.092403</td>
    </tr>
    <tr>
      <th>124</th>
      <td>1386.556532</td>
      <td>693.781904</td>
      <td>246.156066</td>
      <td>123.581671</td>
    </tr>
    <tr>
      <th>125</th>
      <td>1457.593646</td>
      <td>729.300461</td>
      <td>175.118952</td>
      <td>88.063114</td>
    </tr>
  </tbody>
</table>
<p>126 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

