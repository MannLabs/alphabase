"""Integration tests for the PSM Readers.

Tests the output of defined inputs against reference data, which are expected in the `reference_data` folder.

Most of the test data is taken from psm_readers.ipynb
"""

import io
import logging
import os
from io import StringIO
from pathlib import Path
from unittest import skip

import numpy as np
import pandas as pd
import pytest

from alphabase.psm_reader import (
    AlphaDiaReaderTsv,
    DiannReader,
    MaxQuantReader,
    SageReaderTSV,
    SpectronautReader,
    SpectronautReportReader,
    SwathReader,
    pFindReader,
    psm_reader_yaml,
)
from alphabase.psm_reader.keys import LibPsmDfCols, PsmDfCols
from alphabase.spectral_library.reader import LibraryReaderBase
from alphabase.tools.data_downloader import DataShareDownloader

TEST_DATA_MAXQUANT = """Raw file	Scan number	Scan index	Sequence	Length	Missed cleavages	Modifications	Modified sequence	Oxidation (M) Probabilities	Oxidation (M) Score diffs	Acetyl (Protein N-term)	Oxidation (M)	Proteins	Charge	Fragmentation	Mass analyzer	Type	Scan event number	Isotope index	m/z	Mass	Mass error [ppm]	Mass error [Da]	Simple mass error [ppm]	Retention time	PEP	Score	Delta score	Score diff	Localization prob	Combinatorics	PIF	Fraction of total spectrum	Base peak fraction	Precursor full scan number	Precursor Intensity	Precursor apex fraction	Precursor apex offset	Precursor apex offset time	Matches	Intensities	Mass deviations [Da]	Mass deviations [ppm]	Masses	Number of matches	Intensity coverage	Peak coverage	Neutral loss level	ETD identification type	Reverse	All scores	All sequences	All modified sequences	Reporter PIF	Reporter fraction	id	Protein group IDs	Peptide ID	Mod. peptide ID	Evidence ID	Oxidation (M) site IDs
    20190402_QX1_SeVW_MA_HeLa_500ng_LC11	81358	73979	AAAAAAAAAPAAAATAPTTAATTAATAAQ	29	0	Unmodified	_(Acetyl (Protein N-term))AAAAAAAAM(Oxidation (M))PAAAATAPTTAATTAATAAQ_			0	0	sp|P37108|SRP14_HUMAN	3	HCD	FTMS	MULTI-MSMS	13	1	790.07495	2367.203	0.35311	0.00027898	-0.061634807	70.261	0.012774	41.423	36.666	NaN	NaN	1	0	0	0	81345	10653955	0.0338597821787898	-11	0.139877319335938	y1;y2;y3;y4;y11;y1-NH3;y2-NH3;a2;b2;b3;b4;b5;b6;b7;b8;b9;b11;b12;b6(2+);b8(2+);b13(2+);b18(2+)	2000000;2000000;300000;400000;200000;1000000;400000;300000;600000;1000000;2000000;3000000;3000000;3000000;3000000;2000000;600000;500000;1000000;2000000;300000;200000	5.2861228709844E-06;-6.86980268369553E-05;-0.00238178789771837;0.000624715964988809;-0.0145624692099773;-0.000143471782706683;-0.000609501446461991;-0.000524972720768346;0.00010190530804266;5.8620815195809E-05;0.000229901232955854;-0.000108750048696038;-0.000229593152369034;0.00183148682538103;0.00276641182404092;0.000193118923334623;0.00200988580445483;0.000102216846016745;5.86208151389656E-05;0.000229901232955854;-0.00104559184393338;0.00525030008475369	0.0359413365445091;-0.314964433555295;-8.23711898839045;1.60102421155213;-14.8975999917227;-1.10320467763838;-3.03102462870716;-4.56152475051625;0.712219104095465;0.273777366204575;0.806231096969562;-0.305312183824154;-0.537399178230218;3.67572664689217;4.85930954169285;0.301587577451224;2.48616190909398;0.116225745519871;0.273777365939099;0.806231096969562;-2.19774169175011;7.53961026980589	147.076413378177;218.113601150127;289.153028027798;390.197699998035;977.50437775671;130.050013034583;201.087592852046;115.087114392821;143.081402136892;214.118559209185;285.155501716567;356.192954155649;427.230188786552;498.265241494374;569.301420357176;640.341107437877;808.429168310795;879.468189767554;214.118559209185;285.155501716567;475.757386711244;696.362265007215	22	0.262893575628735	0.0826446280991736	None	Unknown		41.4230894199432;4.75668724862449;3.9515580701967	AAAAAAAAAPAAAATAPTTAATTAATAAQ;FHRGPPDKDDMVSVTQILQGK;PVTLWITVTHMQADEVSVWR	_AAAAAAAAAPAAAATAPTTAATTAATAAQ_;_FHRGPPDKDDMVSVTQILQGK_;_PVTLWITVTHMQADEVSVWR_			0	1443	0	0	0
    20190402_QX1_SeVW_MA_HeLa_500ng_LC11	81391	74010	AAAAAAAAAAPAAAATAPTTAATTAATAAQ	29	0	Unmodified	_AAAAAAAAAPAAAATAPTTAATTAATAAQ_			0	0	sp|P37108|SRP14_HUMAN	2	HCD	FTMS	MULTI-MSMS	14	0	1184.6088	2367.203	0.037108	4.3959E-05	1.7026696	70.287	7.1474E-09	118.21	100.52	NaN	NaN	1	0	0	0	81377	9347701	0.166790347889974	-10	0.12664794921875	y1;y2;y3;y4;y5;y9;y12;y13;y14;y20;y13-H2O;y20-H2O;y1-NH3;y20-NH3;b3;b4;b5;b6;b7;b8;b9;b11;b12;b13;b14;b15;b16;b19;b15-H2O;b16-H2O	500000;600000;200000;400000;200000;100000;200000;1000000;200000;300000;200000;100000;100000;70000;300000;900000;2000000;3000000;5000000;8000000;6000000;600000;800000;600000;200000;300000;200000;300000;300000;1000000	-0.000194444760495571;0.000149986878682284;0.000774202587820128;-0.0002445094036716;0.000374520568641401;-0.00694293246522193;-0.0109837291331587;-0.0037745820627606;-0.000945546471939451;0.00152326440706929;0.00506054832726477;0.00996886361417637;6.25847393393997E-05;-0.024881067836759;-3.11821549132674E-05;-0.000183099230639527;0.000161332473453513;0.000265434980121881;0.000747070697229901;0.000975534518261156;0.00101513939785036;0.00651913000274362;0.0058584595163893;0.00579536744021425;0.00131097834105276;-0.0131378531671089;0.00472955218901916;-0.00161006322559842;-0.00201443239325272;0.0227149399370319	-1.32206444236914;0.687655553213019;2.6775131607882;-0.626628140021726;0.811995006209331;-8.6203492854282;-10.1838066275079;-3.21078702288986;-0.758483069159249;0.881072738747222;4.37168212373889;5.82682888353564;0.481236695337485;-14.5343986203644;-0.145630261806375;-0.642102166533079;0.452935954800214;0.621293379181583;1.49934012872483;1.71355878380837;1.58531240493271;8.06399202403175;6.6614096214532;6.09718023739784;1.28333378040908;-11.7030234519348;3.96235146626144;-1.07856912288932;-1.82370619437775;19.3220953109188	147.07661310906;218.113382465221;289.149872037312;390.198569223404;461.235063981231;805.411965958065;1078.54847749073;1175.59403219566;1246.62831694787;1728.87474561429;1157.57463237897;1710.85573532879;130.049806978061;1711.87460084504;214.118649012155;285.155914717031;356.192684073126;427.22969375842;498.266325910503;569.303211234482;640.340285417402;808.424659066597;879.462433524883;950.49961040476;1021.54120858166;1122.60333588727;1193.62258226971;1492.77704268533;1104.58164778019;1175.59403219566	30	0.474003002083763	0.167630057803468	None	Unknown		118.209976573419;17.6937689289157;17.2534171481793	AAAAAAAAAPAAAATAPTTAATTAATAAQ;SELKQEAMQSEQLQSVLYLK;VGSSVPSKASELVVMGDHDAARR	_AAAAAAAAAPAAAATAPTTAATTAATAAQ_;_SELKQEAM(Oxidation (M))QSEQLQSVLYLK_;_VGSSVPSKASELVVMGDHDAARR_			1	1443	0	0	1
    20190402_QX1_SeVW_MA_HeLa_500ng_LC11	107307	98306	AAAAAAAGDSDSWDADAFSVEDPVRK	26	1	Acetyl (Protein N-term)	_(Acetyl (Protein N-term))AAAAAAAGDSDSWDADAFSVEDPVRK_			1	0	sp|O75822|EIF3J_HUMAN	3	HCD	FTMS	MULTI-MSMS	10	2	879.06841	2634.1834	-0.93926	-0.00082567	-3.2012471	90.978	2.1945E-12	148.95	141.24	NaN	NaN	1	0	0	0	107297	10193939	0.267970762043589	-8	0.10211181640625	y1;y2;y4;y5;y6;y7;y8;y9;y10;y11;y12;y13;y14;y15;y17;y18;y19;y20;y21;y23;y21-H2O;y1-NH3;y19-NH3;y14(2+);y16(2+);y22(2+);a2;b2;b3;b4;b5;b6;b7	300000;200000;3000000;600000;1000000;500000;2000000;1000000;1000000;1000000;90000;1000000;400000;900000;1000000;400000;3000000;2000000;1000000;400000;100000;200000;200000;80000;100000;200000;200000;2000000;5000000;5000000;5000000;2000000;300000	1.34859050149316E-07;-6.05140996867704E-06;2.27812602133781E-05;0.00128986659160546;-0.00934536073077652;0.000941953783126337;-0.00160424237344614;-0.00239257341399934;-0.00111053968612396;-0.00331340710044969;0.00330702864630439;0.000963683996815234;0.00596290290945944;-0.00662057038289277;-0.0117122701335575;0.00777853472800416;0.0021841542961738;0.000144322111736983;-0.00087403893667215;0.0197121595674616;-0.021204007680808;-0.000308954599830713;-0.026636719419912;-0.0137790992353075;0.00596067266928912;-0.0077053835773313;9.11402199221811E-06;-0.000142539300128419;-0.000251999832926231;1.90791054137662E-05;-0.00236430185879044;-9.54583337602344E-05;-0.000556959493223985	0.000916705048437201;-0.0199575598103408;0.0456231928690862;2.09952637717462;-12.5708704058425;1.11808305811426;-1.72590731777249;-2.22239181008062;-0.967696370445928;-2.62418809422166;2.47964286628144;0.665205752892023;3.64753748704453;-3.84510115530963;-6.08782672045773;3.81508105974837;1.04209904973991;0.0666012719936656;-0.390545453668809;8.28224925531311;-9.55133250134922;-2.37499239179248;-12.8127653858411;-16.846761946123;6.48662354975264;-6.67117082062383;0.0580151981289049;-0.770098855873447;-0.983876895688683;0.0583162347158579;-5.93738717724506;-0.203431522818505;-1.03087538746314	147.112804035741;303.21392125011;499.33507018564;614.360746132308;743.413974455831;842.472101057517;929.506675663573;1076.57587791081;1147.61170966489;1262.6408555643;1333.67134891635;1448.700635293;1634.77494902759;1721.81956091078;1923.88362405243;2038.89107627957;2095.9181343836;2166.95728800359;2237.99542015244;2380.04906152953;2220.00518543488;130.0865640237;2078.92040615582;817.907873297785;918.917619246831;1155.02717356753;157.097144992378;185.0922112678;256.129434516133;327.166277224995;398.205774393759;469.240619338034;540.278194626993	33	0.574496146107112	0.14410480349345	None	Unknown		148.951235201399;7.71201258444522;7.36039532447559	AAAAAAAGDSDSWDADAFSVEDPVRK;PSRQESELMWQWVDQRSDGER;HTLTSFWNFKAGCEEKCYSNR	_(Acetyl (Protein N-term))AAAAAAAGDSDSWDADAFSVEDPVRK_;_PSRQESELM(Oxidation (M))WQWVDQRSDGER_;_HTLTSFWNFKAGCEEKCYSNR_			2	625	1	1	2	"""

TEST_DATA_PFIND = """File_Name	Scan_No	Exp.MH+	Charge	Q-value	Sequence	Calc.MH+	Mass_Shift(Exp.-Calc.)	Raw_Score	Final_Score	Modification	Specificity	Proteins	Positions	Label	Target/Decoy	Miss.Clv.Sites	Avg.Frag.Mass.Shift	Others
    Ecoli-1to1to1-un-C13-N15-10mM-20150823.30507.30507.2.0.dta	30507	2074.030369	2	0	AMIEAGAAAVHFEDQLASVK	2074.027271	0.003098	35.299588	5.15726e-013	2,Oxidation[M];	3	gi|16131841|ref|NP_418439.1|/	173,K,K/	1|0|	target	0	0.948977	131070	0	0	0	262143	0	0	0	32
    Ecoli-1to1to1-un-C13-N15-150mM-20150823.41501.41501.3.0.dta	41501	2712.197421	3	0	EGDNYVVLSDILGDEDHLGDMDFK	2712.198013	-0.000592	27.073978	9.82619e-010	21,Unknown[M];	3	gi|145698316|ref|NP_417633.4|/	470,K,V/	1|0|	target	0	0.814438	65596	0	0	0	4194288	0	0	0	36
    XXX.25802.25802.4.0.dta	25802	2388.339186	4	0.0032066	SVFLIKGDKVWVYPPEKKEK	2388.332468	0.006718	17.822784	0.100787	21,Didehydro[AnyC-termK];	0	sp|P02790|HEMO_HUMAN/	106,N,G/	1|0|	target	0	0.704714	36
    """

TEST_DATA_DIANN = """File.Name	Run	Protein.Group	Protein.Ids	Protein.Names	Genes	PG.Quantity	PG.Normalised	PG.MaxLFQ	Genes.Quantity	Genes.Normalised	Genes.MaxLFQ	Genes.MaxLFQ.Unique	Modified.Sequence	Stripped.Sequence	Precursor.Id	Precursor.Charge	Q.Value	Global.Q.Value	Protein.Q.Value	PG.Q.Value	Global.PG.Q.Value	GG.Q.Value	Translated.Q.Value	Proteotypic	Precursor.Quantity	Precursor.Normalised	Precursor.Translated	Quantity.Quality	RT	RT.Start	RT.Stop	iRT	Predicted.RT	Predicted.iRT	Lib.Q.Value	Ms1.Profile.Corr	Ms1.Area	Evidence	Spectrum.Similarity	Mass.Evidence	CScore	Decoy.Evidence	Decoy.CScore	Fragment.Quant.Raw	Fragment.Quant.Corrected	Fragment.Correlations	MS2.Scan	IM	iIM	Predicted.IM	Predicted.iIM
    F:\XXX\20201218_tims03_Evo03_PS_SA_HeLa_200ng_high_speed_21min_8cm_S2-A2_1_22636.d	20201218_tims03_Evo03_PS_SA_HeLa_200ng_high_speed_21min_8cm_S2-A2_1_22636	Q9UH36	Q9UH36		SRRD	3296.49	3428.89	3428.89	3296.49	3428.89	3428.89	3428.89	(UniMod:1)AAAAAAALESWQAAAPR	AAAAAAALESWQAAAPR	(UniMod:1)AAAAAAALESWQAAAPR2	2	3.99074e-05	1.96448e-05	0.000159821	0.000159821	0.000146135	0.000161212	0	1	3296.49	3428.89	3296.49	0.852479	19.9208	19.8731	19.9685	123.9	19.8266	128.292	0	0.960106	5308.05	1.96902	0.683134	0.362287	0.999997	1.23691	3.43242e-05	1212.01;2178.03;1390.01;1020.01;714.008;778.008;	1212.01;1351.73;887.591;432.92;216.728;732.751;	0.956668;0.757581;0.670497;0.592489;0.47072;0.855203;	30053	1.19708	1.19328	1.19453	1.19469
    F:\XXX\20201218_tims03_Evo03_PS_SA_HeLa_200ng_high_speed_21min_8cm_S2-A8_1_22642.d	20201218_tims03_Evo03_PS_SA_HeLa_200ng_high_speed_21min_8cm_S2-A8_1_22642	Q9UH36	Q9UH36		SRRD	2365	2334.05	2334.05	2365	2334.05	2334.05	2334.05	(UniMod:1)AAAAAAALESWQAAAPR	AAAAAAALESWQAAAPR	(UniMod:1)AAAAAAALESWQAAAPR2	2	0.000184434	1.96448e-05	0.000596659	0.000596659	0.000146135	0.000604961	0	1	2365	2334.05	2365	0.922581	19.905	19.8573	19.9527	123.9	19.782	128.535	0	0.940191	4594.04	1.31068	0.758988	0	0.995505	0.28633	2.12584e-06	1209.02;1210.02;1414.02;1051.01;236.003;130.002;	1209.02;1109.89;732.154;735.384;0;46.0967;	0.919244;0.937624;0.436748;0.639369;0.296736;0.647924;	30029	1.195	1.19328	1.19381	1.19339
    F:\XXX\20201218_tims03_Evo03_PS_SA_HeLa_200ng_high_speed_21min_8cm_S2-B2_1_22648.d	20201218_tims03_Evo03_PS_SA_HeLa_200ng_high_speed_21min_8cm_S2-B2_1_22648	Q9UH36	Q9UH36		SRRD	1664.51	1635.46	1635.47	1664.51	1635.46	1635.47	1635.47	(UniMod:1)AAAAAAALESWQAAAPR	AAAAAAALESWQAAAPR	(UniMod:1)AAAAAAALESWQAAAPR2	2	0.000185123	1.96448e-05	0.000307409	0.000307409	0.000146135	0.000311332	0	1	1664.51	1635.46	1664.51	0.811147	19.8893	19.8416	19.937	123.9	19.7567	128.896	0	0.458773	6614.06	1.7503	0.491071	0.00111683	0.997286	1.92753	2.80543e-05	744.01;1708.02;1630.02;1475.02;0;533.006;	322.907;808.594;577.15;536.033;0;533.006;	0.760181;0.764072;0.542005;0.415779;0;0.913438;	30005	1.19409	1.19328	1.19323	1.19308
    """

TEST_DATA_SPECTRONAUT = """ReferenceRun	PrecursorCharge	Workflow	IntModifiedPeptide	CV	AllowForNormalization	ModifiedPeptide	StrippedPeptide	iRT	IonMobility	iRTSourceSpecific	BGSInferenceId	IsProteotypic	IntLabeledPeptide	LabeledPeptide	PrecursorMz	ReferenceRunQvalue	ReferenceRunMS1Response	FragmentLossType	FragmentNumber	FragmentType	FragmentCharge	FragmentMz	RelativeIntensity	ExcludeFromAssay	Database	ProteinGroups	UniProtIds	Protein Name	ProteinDescription	Organisms	OrganismId	Genes	Protein Existence	Sequence Version	FASTAName
    202106018_TIMS03_EVO03_PaSk_SA_HeLa_EGF_Phospho_100ug_test_S4-A1_1_25843	2		_ALVAT[+80]PGK_		True	_ALVAT[Phospho (STY)]PGK_	ALVATPGK	-5.032703	0.758	-5.032703	P19338	False	_ALVAT[+80]PGK_	_ALVAT[Phospho (STY)]PGK_	418.717511324722	0	10352	noloss	3	y	1	301.187031733932	53.1991	False	sp	P19338	P19338	NUCL_HUMAN	Nucleolin	Homo sapiens		NCL	1	3	MCT_human_UP000005640_9606
    202106018_TIMS03_EVO03_PaSk_SA_HeLa_EGF_Phospho_100ug_test_S4-A1_1_25843	2		_ALVAT[+80]PGK_		True	_ALVAT[Phospho (STY)]PGK_	ALVATPGK	-5.032703	0.758	-5.032703	P19338	False	_ALVAT[+80]PGK_	_ALVAT[Phospho (STY)]PGK_	418.717511324722	0	10352	H3PO4	4	y	1	384.224142529733	26.31595	False	sp	P19338	P19338	NUCL_HUMAN	Nucleolin	Homo sapiens		NCL	1	3	MCT_human_UP000005640_9606
    202106018_TIMS03_EVO03_PaSk_SA_HeLa_EGF_Phospho_100ug_test_S4-A1_1_25843	2		_TLT[+80]PCPLR_		True	_TLT[Phospho (STY)]PC[Carbamidomethyl (C)]PLR_	TLTPCPLR	27.71659	0.818	27.71659	Q5T200	False	_TLT[+80]PPLR_	_TLT[Phospho (STY)]PPLR_	439.230785875227	0.000138389150379226	23117	noloss	3	b	1	396.153027901512	6.3264	False	sp	Q5T200	Q5T200	ZC3HD_HUMAN	Zinc finger CCCH domain-containing protein 13	Homo sapiens		ZC3H13	1	1	MCT_human_UP000005640_9606
    202106018_TIMS03_EVO03_PaSk_SA_HeLa_EGF_Phospho_100ug_test_S4-A1_1_25843	2		_TLT[+80]PCPLR_		True	_TLT[Phospho (STY)]PC[Carbamidomethyl (C)]PLR_	TLTPCPLR	27.71659	0.818	27.71659	Q5T200	False	_TLT[+80]PPLR_	_TLT[Phospho (STY)]PPLR_	439.230785875227	0.000138389150379226	23117	noloss	3	y	1	385.255780000092	29.70625	False	sp	Q5T200	Q5T200	ZC3HD_HUMAN	Zinc finger CCCH domain-containing protein 13	Homo sapiens		ZC3H13	1	1	MCT_human_UP000005640_9606
    202106018_TIMS03_EVO03_PaSk_SA_HeLa_EGF_Phospho_library25_S4-C1_1_25867	2		_LFVT[+80]PPEGSSR_		True	_[Acetyl (Protein N-term)]LFVS[Phospho (STY)]PPEGSSR_	LFVSPPEGSSR	38.05031	0.917	38.05031	Q14244;Q14244-6;Q14244-7	False	_LFVT[+80]PPEGSSR_	_LFVT[Phospho (STY)]PPEGSSR_	635.297385373987	0	14164	H3PO4	4	b	1	443.265279065723	12.24525	False	sp	Q14244;Q14244-6;Q14244-7	Q14244;Q14244-6;Q14244-7	MAP7_HUMAN	Ensconsin;Isoform of Q14244, Isoform 6 of Ensconsin;Isoform of Q14244, Isoform 7 of Ensconsin	Homo sapiens		MAP7	1;;	1;;	MCT_human_UP000005640_9606;MCT_human2_UP000005640_9606_additional;MCT_human2_UP000005640_9606_additional
    202106018_TIMS03_EVO03_PaSk_SA_HeLa_EGF_Phospho_library25_S4-C1_1_25867	2		_LFVT[+80]PPEGSSR_		True	_[Acetyl (Protein N-term)]LFVS[Phospho (STY)]PPEGSSR_	LFVSPPEGSSR	38.05031	0.917	38.05031	Q14244;Q14244-6;Q14244-7	False	_LFVT[+80]PPEGSSR_	_LFVT[Phospho (STY)]PPEGSSR_	635.297385373987	0	14164	noloss	6	y	1	632.299829640042	46.07855	False	sp	Q14244;Q14244-6;Q14244-7	Q14244;Q14244-6;Q14244-7	MAP7_HUMAN	Ensconsin;Isoform of Q14244, Isoform 6 of Ensconsin;Isoform of Q14244, Isoform 7 of Ensconsin	Homo sapiens		MAP7	1;;	1;;	MCT_human_UP000005640_9606;MCT_human2_UP000005640_9606_additional;MCT_human2_UP000005640_9606_additional
    202106018_TIMS03_EVO03_PaSk_SA_HeLa_EGF_Phospho_library25_S4-C1_1_25867	2		_LFVT[+80]PPEGSSR_		True	_[Acetyl (Protein N-term)]LFVS[Phospho (STY)]PPEGSSR_	LFVSPPEGSSR	38.05031	0.917	38.05031	Q14244;Q14244-6;Q14244-7	False	_LFVT[+80]PPEGSSR_	_LFVT[Phospho (STY)]PPEGSSR_	635.297385373987	0	14164	noloss	7	y	1	729.352593488892	100	False	sp	Q14244;Q14244-6;Q14244-7	Q14244;Q14244-6;Q14244-7	MAP7_HUMAN	Ensconsin;Isoform of Q14244, Isoform 6 of Ensconsin;Isoform of Q14244, Isoform 7 of Ensconsin	Homo sapiens		MAP7	1;;	1;;	MCT_human_UP000005640_9606;MCT_human2_UP000005640_9606_additional;MCT_human2_UP000005640_9606_additional
    """

TEST_DATA_SPECTRONAUT_REPORT = """R.FileName,R.Replicate,EG.PrecursorId,EG.ApexRT,FG.CalibratedMassAccuracy (PPM),FG.CalibratedMz
    20211203_EXPL2_SoSt_SA_DIA_HeLa_1000mz_noCB_01,1,_VIETPENDFK_.2,40.826847076416,-0.6350307649846,596.298998773218
    20211203_EXPL2_SoSt_SA_DIA_HeLa_1000mz_noCB_01,1,_GFSNEVSSK_.2,19.1254806518555,-1.54873822486555,477.730400257423
    20211203_EXPL2_SoSt_SA_DIA_HeLa_1000mz_noCB_01,1,_HLLNQAVGEEEVPK_.3,42.0593299865723,-0.309173676987587,521.611288926824
    20211203_EXPL2_SoSt_SA_DIA_HeLa_1000mz_noCB_01,1,_DATM[Oxidation (M)]EVQR_.2,12.8398199081421,-3.31103772642203,483.222124398527
    """

TEST_DATA_OPENSWATH = """PrecursorMz	ProductMz	Tr_recalibrated	transition_name	CE	LibraryIntensity	transition_group_id	decoy	PeptideSequence	ProteinName	Annotation	FullUniModPeptideName	PrecursorCharge	GroupLabel	UniprotID	FragmentType	FragmentCharge	FragmentSeriesNumber
    685.732240417	886.020494795	59.0	255_AAAAAAAAAASGAAIPPLIPPRR_3	-1	5257.9	13_AAAAAAAAAASGAAIPPLIPPRR_3	0	AAAAAAAAAASGAAIPPLIPPRR	1/O14654	y19^2/0.002	AAAAAAAAAASGAAIPPLIPPRR	3	light	1/O14654	y	2	19
    514.550999438	473.303261576	59.2	268_AAAAAAAAAASGAAIPPLIPPRR_4	-1	10000.0	14_AAAAAAAAAASGAAIPPLIPPRR_4	0	AAAAAAAAAASGAAIPPLIPPRR	1/O14654	y8^2/0.002	AAAAAAAAAASGAAIPPLIPPRR	4	light	1/O14654	y	2	8
    514.550999438	629.39313922	59.2	276_AAAAAAAAAASGAAIPPLIPPRR_4	-1	5923.1	14_AAAAAAAAAASGAAIPPLIPPRR_4	0	AAAAAAAAAASGAAIPPLIPPRR	1/O14654	y12^2/0.001	AAAAAAAAAASGAAIPPLIPPRR	4	light	1/O14654	y	2	12
    514.550999438	672.909153425	59.2	279_AAAAAAAAAASGAAIPPLIPPRR_4	-1	5249.8	14_AAAAAAAAAASGAAIPPLIPPRR_4	0	AAAAAAAAAASGAAIPPLIPPRR	1/O14654	y13^2/0.001	AAAAAAAAAASGAAIPPLIPPRR	4	light	1/O14654	y	2	13
    514.550999438	356.19284545	59.2	262_AAAAAAAAAASGAAIPPLIPPRR_4	-1	5233.6	14_AAAAAAAAAASGAAIPPLIPPRR_4	0	AAAAAAAAAASGAAIPPLIPPRR	1/O14654	b5/0.001,b10^2/0.001,m6:10/0.001	AAAAAAAAAASGAAIPPLIPPRR	4	light	1/O14654	b	1	5
    514.550999438	498.26707303	59.2	269_AAAAAAAAAASGAAIPPLIPPRR_4	-1	4976.0	14_AAAAAAAAAASGAAIPPLIPPRR_4	0	AAAAAAAAAASGAAIPPLIPPRR	1/O14654	b7/0.001,m4:10/0.001	AAAAAAAAAASGAAIPPLIPPRR	4	light	1/O14654	b	1	7
    514.550999438	427.22995924	59.2	265_AAAAAAAAAASGAAIPPLIPPRR_4	-1	4859.4	14_AAAAAAAAAASGAAIPPLIPPRR_4	0	AAAAAAAAAASGAAIPPLIPPRR	1/O14654	b6/0.002,m5:10/0.002	AAAAAAAAAASGAAIPPLIPPRR	4	light	1/O14654	b	1	6
    728.201724416	356.19284545	101.8	292_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	-1	10000.0	15_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	0	AAAAAAAAAASGAAIPPLIPPRRVITLYQCFSVSQR	1/O14654	b5/0.003,b10^2/0.003,m6:10/0.003	AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR	5	light	1/O14654	b	1	5
    728.201724416	576.310000482	101.8	297_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	-1	7611.0	15_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	0	AAAAAAAAAASGAAIPPLIPPRRVITLYQCFSVSQR	1/O14654	y5/0.002	AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR	5	light	1/O14654	y	1	5
    728.201724416	427.22995924	101.8	293_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	-1	6805.1	15_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	0	AAAAAAAAAASGAAIPPLIPPRRVITLYQCFSVSQR	1/O14654	b6/-0.002,m5:10/-0.002	AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR	5	light	1/O14654	b	1	6
    728.201724416	569.30418682	101.8	296_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	-1	6312.7	15_AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR_5	0	AAAAAAAAAASGAAIPPLIPPRRVITLYQCFSVSQR	1/O14654	b8/0.009,m3:10/0.009	AAAAAAAAAASGAAIPPLIPPRRVITLYQC(UniMod:4)FSVSQR	5	light	1/O14654	b	1	8
    """

TEST_DATA_SAGE = """	psm_id	filename	scannr	peptide	stripped_peptide	proteins	num_proteins	rank	is_decoy	expmass	calcmass	charge	peptide_len	missed_cleavages	isotope_error	precursor_ppm	fragment_ppm	hyperscore	delta_next	delta_best	rt	aligned_rt	predicted_rt	delta_rt_model	ion_mobility	predicted_mobility	delta_mobility	matched_peaks	longest_b	longest_y	longest_y_pct	matched_intensity_pct	scored_candidates	poisson	sage_discriminant_score	posterior_error	spectrum_q	peptide_q	protein_q	reporter_ion_intensity
8	142704	60_3.mzML	controllerType=0 controllerNumber=1 scan=10849	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8253	1867.8258	2	20	0	0.0	0.26141694	1.721784	60.113186	36.14437	0.0	20.148993	0.3073842	0.3443281	0.036943913	0.0	0.0	0.0	21	3	15	0.75	43.198597	867	-19.245937	1.469355	-123.91524	2.6009155e-05	0.00021067557	0.0007049733
20	5032	60_3.mzML	controllerType=0 controllerNumber=1 scan=36367	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7886	1564.7885	2	14	0	0.0	0.07801074	3.779504	47.841354	47.841354	0.0	57.77905	0.69755405	0.6982606	0.00070655346	0.0	0.0	0.0	14	2	11	0.78571427	53.4955	650	-11.393467	1.4494852	-116.618454	2.6009155e-05	0.00021067557	0.0007049733
26	103642	60_2.mzML	controllerType=0 controllerNumber=1 scan=11301	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8267	1867.8258	2	20	0	0.0	0.4574795	2.0042152	61.128662	35.100517	0.0	20.735882	0.31321254	0.3443281	0.031115562	0.0	0.0	0.0	21	4	15	0.75	51.04391	951	-18.866474	1.4444113	-114.899345	2.6009155e-05	0.00021067557	0.0007049733
27	40668	92_1.mzML	controllerType=0 controllerNumber=1 scan=23006	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9526	1942.9493	2	18	0	0.0	1.6963364	1.3936315	58.108223	33.16377	0.0	82.580246	0.81587523	0.815108	0.000767231	0.0	0.0	0.0	20	6	13	0.7222222	49.05854	3115	-17.70197	1.4437885	-114.55982	2.6009155e-05	0.00021067557	0.0007049733
31	83712	92_3.mzML	controllerType=0 controllerNumber=1 scan=13248	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8258	1867.8258	2	20	0	0.0	0.0	1.1509973	55.513035	32.938152	0.0	52.751286	0.500258	0.3443281	0.15592992	0.0	0.0	0.0	19	3	15	0.75	60.65933	532	-16.854006	1.4414786	-113.71719	2.6009155e-05	0.00021067557	0.0007049733
47	116751	92_2.mzML	controllerType=0 controllerNumber=1 scan=23783	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9492	1942.9493	2	18	0	0.0	0.062827334	2.3912728	51.0983	29.83201	0.0	83.31647	0.81750995	0.815108	0.002401948	0.0	0.0	0.0	18	5	12	0.6666667	41.517128	1512	-15.638941	1.4351723	-111.47712	2.6009155e-05	0.00021067557	0.0007049733
48	75066	60_1.mzML	controllerType=0 controllerNumber=1 scan=10733	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8248	1867.8258	2	20	0	0.0	0.52283394	1.9717236	60.003254	35.564194	0.0	19.938667	0.30874074	0.3443281	0.03558737	0.0	0.0	0.0	21	3	13	0.65	43.683895	972	-19.141006	1.433924	-111.12174	2.6009155e-05	0.00021067557	0.0007049733
103	50697	92_1.mzML	controllerType=0 controllerNumber=1 scan=23720	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9476	1942.9493	2	18	0	0.0	0.87958294	2.3606424	54.49117	31.300709	0.0	84.92172	0.8413776	0.815108	0.026269615	0.0	0.0	0.0	19	6	12	0.6666667	60.769127	1527	-16.87297	1.418942	-105.88267	2.6009155e-05	0.00021067557	0.0007049733
133	83246	60_1.mzML	controllerType=0 controllerNumber=1 scan=36513	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7881	1564.7885	2	14	0	0.0	0.23403226	1.8019745	53.468285	24.098793	0.0	57.69109	0.69816566	0.6982606	9.49502e-05	0.0	0.0	0.0	17	5	11	0.78571427	52.221935	1063	-14.478454	1.4107668	-103.023895	2.6009155e-05	0.00021067557	0.0007049733
140	146051	60_3.mzML	controllerType=0 controllerNumber=1 scan=11797	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8278	1867.8258	2	20	0	0.0	1.045667	1.86006	59.4344	35.609222	0.0	21.476482	0.32114837	0.3443281	0.02317974	0.0	0.0	0.0	21	6	12	0.6	51.3682	815	-19.52154	1.4079692	-102.16886	2.6009155e-05	0.00021067557	0.0007049733
146	75905	60_1.mzML	controllerType=0 controllerNumber=1 scan=11206	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8296	1867.8258	2	20	0	0.0	2.025979	2.042719	65.343155	39.391674	0.0	20.591623	0.31547612	0.3443281	0.028851986	0.0	0.0	0.0	23	6	15	0.75	50.918007	902	-21.468779	1.4054787	-101.22193	2.6009155e-05	0.00021067557	0.0007049733
161	48092	92_1.mzML	controllerType=0 controllerNumber=1 scan=23414	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9536	1942.9493	2	18	0	0.0	2.198954	2.5817542	57.281048	33.506477	0.0	83.75223	0.82864	0.815108	0.013531983	0.0	0.0	0.0	20	6	13	0.7222222	54.291546	2211	-17.757523	1.4029326	-100.32633	2.6009155e-05	0.00021067557	0.0007049733
222	64970	60_2.mzML	controllerType=0 controllerNumber=1 scan=36273	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7885	1564.7885	2	14	0	0.0	0.0	1.6579754	47.599255	21.143196	0.0	57.183372	0.68598354	0.6982606	0.012277067	0.0	0.0	0.0	14	2	11	0.78571427	43.497463	935	-11.309314	1.3911021	-96.48106	2.6009155e-05	0.00021067557	0.0007049733
333	97551	92_2.mzML	controllerType=0 controllerNumber=1 scan=24258	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9473	1942.9493	2	18	0	0.0	1.0680652	3.3345053	49.05846	26.501554	0.0	84.99367	0.83497685	0.815108	0.01986885	0.0	0.0	0.0	17	5	11	0.6111111	50.140057	1469	-14.548144	1.3764344	-91.65825	2.6009155e-05	0.00021067557	0.0007049733
355	83414	92_3.mzML	controllerType=0 controllerNumber=1 scan=23776	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9453	1942.9493	2	18	0	0.0	2.073304	2.5707543	49.055405	26.928013	0.0	83.742226	0.82465184	0.815108	0.009543836	0.0	0.0	0.0	17	5	11	0.6111111	48.921402	1683	-14.541507	1.3741851	-90.94944	2.6009155e-05	0.00021067557	0.0007049733
362	84405	92_3.mzML	controllerType=0 controllerNumber=1 scan=23925	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9462	1942.9493	2	18	0	0.0	1.6335118	3.6090193	47.0771	24.099607	0.0	84.28615	0.83034533	0.815108	0.015237331	0.0	0.0	0.0	16	4	11	0.6111111	59.127666	1330	-13.387861	1.3736115	-90.77021	2.6009155e-05	0.00021067557	0.0007049733
444	62827	60_1.mzML	controllerType=0 controllerNumber=1 scan=36097	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7897	1564.7885	2	14	0	0.0	0.78010714	3.3237147	47.61031	18.63672	0.0	57.03218	0.69136894	0.6982606	0.006891668	0.0	0.0	0.0	14	2	11	0.78571427	43.80123	1149	-11.234363	1.3650464	-88.04029	2.6009155e-05	0.00021067557	0.0007049733
485	129366	60_3.mzML	controllerType=0 controllerNumber=1 scan=11310	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8314	1867.8258	2	20	0	0.0	3.00629	2.624174	62.73452	38.350216	0.0	20.791553	0.31404662	0.3443281	0.030281484	0.0	0.0	0.0	22	6	15	0.75	51.131317	950	-20.49158	1.3611062	-86.83681	2.6009155e-05	0.00021067557	0.0007049733
694	94194	60_2.mzML	controllerType=0 controllerNumber=1 scan=36689	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.789	1564.7885	2	14	0	0.0	0.31204292	2.467254	46.53228	18.48515	0.0	57.833702	0.6926348	0.6982606	0.0056257844	0.0	0.0	0.0	14	2	9	0.64285713	48.92631	917	-11.190012	1.3465322	-82.279396	2.6009155e-05	0.00021067557	0.0007049733
1002	35238	60_3.mzML	controllerType=0 controllerNumber=1 scan=35951	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7906	1564.7885	2	14	0	0.0	1.4041924	3.7104554	51.358967	23.623558	0.0	57.125263	0.6907752	0.6982606	0.0074853897	0.0	0.0	0.0	16	4	11	0.78571427	37.388786	1713	-13.040493	1.3304021	-77.38705	2.6009155e-05	0.00021067557	0.0007049733
1351	116967	60_2.mzML	controllerType=0 controllerNumber=1 scan=10822	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8279	1867.8258	2	20	0	0.0	1.1110212	1.551006	57.620712	32.377148	0.0	20.076672	0.3064704	0.3443281	0.03785771	0.0	0.0	0.0	20	3	7	0.35	42.659245	1040	-17.90073	1.3151988	-72.95253	2.6009155e-05	0.00021067557	0.0007049733
2473	102110	92_2.mzML	controllerType=0 controllerNumber=1 scan=13334	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8275	1867.8258	2	20	0	0.0	0.9149588	1.2713591	47.13567	24.945572	0.0	52.89372	0.5006777	0.3443281	0.1563496	0.0	0.0	0.0	16	3	7	0.35	62.839863	419	-13.527506	1.274632	-61.78651	2.6009155e-05	0.00021067557	0.0007049733
2627	49351	92_1.mzML	controllerType=0 controllerNumber=1 scan=22124	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7913	1564.7885	2	14	0	0.0	1.7942456	3.5136106	48.26868	25.072329	0.0	80.18822	0.78982216	0.6982606	0.091561556	0.0	0.0	0.0	17	4	11	0.78571427	23.506454	2137	-14.00665	1.2697504	-60.534027	2.6009155e-05	0.00021067557	0.0007049733
2729	84207	92_3.mzML	controllerType=0 controllerNumber=1 scan=23888	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.957	1942.9493	2	18	0	0.0	3.958114	4.304509	53.776257	31.171057	0.0	84.13366	0.8287492	0.815108	0.013641179	0.0	0.0	0.0	19	6	12	0.6666667	51.40552	1587	-16.901001	1.2666808	-59.742786	2.6009155e-05	0.00021067557	0.0007049733
3324	4410	60_3.mzML	controllerType=0 controllerNumber=1 scan=47381	Q[-17.026548]MAEIAVNAVLTVADMER	QMAEIAVNAVLTVADMER	sp|P48643|TCPE_HUMAN	1	1	False	1942.9446	1942.9493	2	18	0	0.0	2.4502687	2.309813	51.336906	23.658417	0.0	76.32473	0.88984627	0.815108	0.074738264	0.0	0.0	0.0	17	5	11	0.6111111	35.97421	3379	-13.763369	1.2502998	-55.59524	2.6009155e-05	0.00021067557	0.0007049733
3953	87609	60_2.mzML	controllerType=0 controllerNumber=1 scan=37108	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7874	1564.7885	2	14	0	0.0	0.702097	5.042141	40.743027	14.576527	0.0	58.481735	0.69926274	0.6982606	0.0010021329	0.0	0.0	0.0	11	1	8	0.5714286	42.27876	1179	-8.10106	1.235976	-52.053837	2.6009155e-05	0.00021067557	0.0007049733
4414	92964	60_1.mzML	controllerType=0 controllerNumber=1 scan=11665	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8276	1867.8258	2	20	0	0.0	0.98031294	2.6539705	47.198505	23.750587	0.0	21.238848	0.3221524	0.3443281	0.0221757	0.0	0.0	0.0	16	2	4	0.2	45.96126	731	-13.339602	1.2264419	-49.851162	2.6009155e-05	0.00021067557	0.0007049733
4955	92589	92_2.mzML	controllerType=0 controllerNumber=1 scan=12958	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8235	1867.8258	2	20	0	0.0	1.241731	3.7892783	39.521255	19.289305	0.0	51.719593	0.48845	0.3443281	0.14412189	0.0	0.0	0.0	13	2	7	0.35	57.977116	410	-10.451294	1.2156374	-47.337612	2.6009155e-05	0.00021067557	0.0007049733
5583	17680	60_3.mzML	controllerType=0 controllerNumber=1 scan=37203	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7881	1564.7885	2	14	0	0.0	0.23403226	5.3514333	41.959015	16.799135	0.0	59.075863	0.71100014	0.6982606	0.012739539	0.0	0.0	0.0	13	2	9	0.64285713	21.580336	2357	-9.564875	1.2039839	-44.663216	2.6009155e-05	0.00021067557	0.0007049733
8599	18321	92_1.mzML	controllerType=0 controllerNumber=1 scan=13025	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8236	1867.8258	2	20	0	0.0	1.1763768	1.4633936	34.939407	34.939407	0.0	52.920715	0.4928354	0.3443281	0.1485073	0.0	0.0	0.0	11	3	5	0.25	67.24076	255	-8.257667	1.1546649	-34.462883	2.6009155e-05	0.00021067557	0.0007049733
9382	102955	60_1.mzML	controllerType=0 controllerNumber=1 scan=37350	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7876	1564.7885	2	14	0	0.0	0.54607534	4.6223836	38.816322	12.38533	0.0	58.99825	0.71164936	0.6982606	0.013388753	0.0	0.0	0.0	11	1	8	0.5714286	19.518412	1908	-7.6888947	1.1436518	-32.391937	2.6009155e-05	0.00021067557	0.0007049733
9521	10034	60_3.mzML	controllerType=0 controllerNumber=1 scan=36786	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7883	1564.7885	2	14	0	0.0	0.07801075	3.294951	38.887325	10.880148	0.0	58.427273	0.7042752	0.6982606	0.0060145855	0.0	0.0	0.0	10	1	6	0.42857143	45.358402	1394	-7.048597	1.1417203	-32.02691	2.6009155e-05	0.00021067557	0.0007049733
10586	100241	60_1.mzML	controllerType=0 controllerNumber=1 scan=36936	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7892	1564.7885	2	14	0	0.0	0.46806437	5.374502	39.988266	12.616597	0.0	58.34234	0.70488346	0.6982606	0.006622851	0.0	0.0	0.0	11	2	6	0.42857143	36.546604	1289	-8.107454	1.127911	-29.548573	2.6009155e-05	0.00021067557	0.0007049733
11002	73696	92_3.mzML	controllerType=0 controllerNumber=1 scan=12873	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8229	1867.8258	2	20	0	0.0	1.5685027	4.3794336	35.0123	35.0123	0.0	51.57614	0.48795745	0.3443281	0.14362934	0.0	0.0	0.0	11	2	5	0.25	53.256207	280	-8.254283	1.1226454	-28.610014	2.6009155e-05	0.00021067557	0.0007049733
14754	29546	60_2.mzML	controllerType=0 controllerNumber=1 scan=37522	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7882	1564.7885	2	14	0	0.0	0.1560215	3.408005	36.588623	10.166926	0.0	59.132023	0.70591366	0.6982606	0.0076530576	0.0	0.0	0.0	10	1	6	0.42857143	18.845667	1297	-6.828486	1.0762528	-21.2153	2.6009155e-05	0.00021067557	0.0007049733
15324	10348	68_2.mzML	controllerType=0 controllerNumber=1 scan=21924	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7899	1564.7885	2	14	0	0.0	0.9361285	3.8206482	33.860077	33.860077	0.0	61.04075	0.72516805	0.6982606	0.026907444	0.0	0.0	0.0	10	1	3	0.21428572	27.249949	1042	-7.073718	1.0694742	-20.240118	2.6009155e-05	0.00021067557	0.0007049733
20226	57968	92_3.mzML	controllerType=0 controllerNumber=1 scan=13678	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8253	1867.8258	2	20	0	0.0	0.26141694	2.3960912	30.55838	30.55838	0.0	54.02552	0.51359594	0.3443281	0.16926783	0.0	0.0	0.0	9	2	3	0.15	64.8568	282	-6.2993364	1.0146971	-13.403037	2.6009155e-05	0.00021067557	0.0007049733
20696	49718	60_2.mzML	controllerType=0 controllerNumber=1 scan=37908	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7894	1564.7885	2	14	0	0.0	0.6240858	3.163965	36.644234	6.270651	0.0	59.77351	0.71247447	0.6982606	0.01421386	0.0	0.0	0.0	11	2	6	0.42857143	13.52776	2443	-7.4045196	1.0097842	-12.869022	2.6009155e-05	0.00021067557	0.0007049733
21281	119382	60_1.mzML	controllerType=0 controllerNumber=1 scan=37747	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7897	1564.7885	2	14	0	0.0	0.78010714	3.0107923	34.046898	7.703591	0.0	59.633354	0.7182006	0.6982606	0.019940019	0.0	0.0	0.0	9	1	8	0.5714286	11.967788	2303	-5.621416	1.0039871	-12.273668	2.6009155e-05	0.00021067557	0.0007049733
36001	113267	92_2.mzML	controllerType=0 controllerNumber=1 scan=13728	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8259	1867.8258	2	20	0	0.0	0.06535422	1.4203613	26.591684	26.591684	0.0	54.088024	0.5131156	0.3443281	0.16878748	0.0	0.0	0.0	7	2	2	0.1	63.369507	257	-4.454959	0.85978854	-3.750797	2.6009155e-05	0.00021067557	0.0007049733
36186	28390	60_3.mzML	controllerType=0 controllerNumber=1 scan=35859	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7911	1564.7885	3	14	0	0.0	1.7162349	4.1754684	32.462246	8.063471	0.0	56.98101	0.6892795	0.6982606	0.008981109	0.0	0.0	0.0	10	3	5	0.35714287	11.218001	3116	-6.2186694	0.85793346	-3.7217407	2.6009155e-05	0.00021067557	0.0007049733
38433	57911	68_3.mzML	controllerType=0 controllerNumber=1 scan=22205	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7903	1564.7885	2	14	0	0.0	1.1701605	3.1494467	26.456993	6.923806	0.0	60.674126	0.7221973	0.6982606	0.023936689	0.0	0.0	0.0	7	1	3	0.21428572	22.149525	666	-4.3702374	0.83644325	-3.5218751	2.6009155e-05	0.00021067557	0.0007049733
42146	79141	60_1.mzML	controllerType=0 controllerNumber=1 scan=36424	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7875	1564.7885	3	14	0	0.0	0.62408614	1.9720329	29.396858	4.2184634	0.0	57.55018	0.6967122	0.6982606	0.0015484095	0.0	0.0	0.0	8	3	4	0.2857143	14.628542	2200	-4.8254676	0.7997928	-3.3840792	6.610259e-05	0.00021067557	0.0007049733
43411	21575	60_3.mzML	controllerType=0 controllerNumber=1 scan=37638	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7882	1564.7885	2	14	0	0.0	0.1560215	5.6354837	32.86765	3.9515662	0.0	59.77223	0.7182205	0.6982606	0.019959867	0.0	0.0	0.0	9	1	3	0.21428572	9.881053	2067	-5.6147118	0.7877456	-3.229581	6.610259e-05	0.00021067557	0.0007049733
43980	10784	92_1.mzML	controllerType=0 controllerNumber=1 scan=12670	MEEESGAPGVPSGN[+0.984016]GAPGPK	MEEESGAPGVPSGNGAPGPK	sp|P52272|HNRPM_HUMAN	1	1	False	1867.8292	1867.8258	2	20	0	0.0	1.8299167	1.8374933	26.119295	26.119295	0.0	51.74325	0.48001093	0.3443281	0.13568282	0.0	0.0	0.0	7	2	1	0.05	58.213627	204	-4.4664435	0.78216696	-3.1521976	6.610259e-05	0.00021067557	0.0007049733
48563	92084	60_2.mzML	controllerType=0 controllerNumber=1 scan=36655	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7905	1564.7885	3	14	0	0.0	1.3261818	3.0831332	26.070871	4.5148196	0.0	57.779457	0.69208	0.6982606	0.0061805844	0.0	0.0	0.0	6	1	4	0.2857143	17.812397	1138	-3.4660137	0.73630303	-2.6680305	0.00020056157	0.00021067557	0.0007049733
51852	61662	60_2.mzML	controllerType=0 controllerNumber=1 scan=36221	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7896	1564.7885	3	14	0	0.0	0.7020964	7.5676193	28.73629	4.4435377	0.0	57.104137	0.68517315	0.6982606	0.013087451	0.0	0.0	0.0	8	3	4	0.2857143	10.925318	2331	-4.8319817	0.70325434	-2.2705057	0.00032395762	0.00021067557	0.0007049733
56254	107790	60_1.mzML	controllerType=0 controllerNumber=1 scan=37155	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7881	1564.7885	3	14	0	0.0	0.23403226	1.1101317	24.397646	2.0240285	0.0	58.68759	0.70844483	0.6982606	0.010184228	0.0	0.0	0.0	6	1	4	0.2857143	7.907757	2490	-3.2228017	0.65660965	-1.9138397	0.0010133153	0.00021067557	0.0007049733
65695	55156	60_1.mzML	controllerType=0 controllerNumber=1 scan=35946	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7876	1564.7885	3	14	0	0.0	0.54607534	3.9860673	25.07365	1.2712177	0.0	56.798138	0.6889547	0.6982606	0.009305894	0.0	0.0	0.0	6	2	3	0.21428572	10.15254	1956	-3.2445283	0.5478867	-1.305784	0.004600688	0.00021067557	0.0007049733
69029	70640	60_2.mzML	controllerType=0 controllerNumber=1 scan=38325	LPIGDVATQYFADR	LPIGDVATQYFADR	sp|Q99832|TCPH_HUMAN	1	1	False	1564.7872	1564.7885	2	14	0	0.0	0.78010774	3.0232615	26.206385	0.14770344	0.0	60.46434	0.7195401	0.6982606	0.021279514	0.0	0.0	0.0	6	1	3	0.21428572	4.999368	2359	-3.1304493	0.5049445	-1.140718	0.0072214277	0.00021067557	0.0007049733
"""

TEST_DATA_DIANN_SPECLIB = """FileName	PrecursorMz	ProductMz	Tr_recalibrated	IonMobility	transition_name	LibraryIntensity	transition_group_id	decoy	PeptideSequence	Proteotypic	QValue	PGQValue	Ms1ProfileCorr	ProteinGroup	ProteinName	Genes	FullUniModPeptideName	ModifiedPeptide	PrecursorCharge	PeptideGroupLabel	UniprotID	NTerm	CTerm	FragmentType	FragmentCharge	FragmentSeriesNumber	FragmentLossType	ExcludeFromAssay
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	645.36896	-17.011904	0	AAAAAAAAAVSR2_121_1_0_5	1	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	7	noloss	False
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	716.40607	-17.011904	0	AAAAAAAAAVSR2_121_1_0_4	0.92588264	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	8	noloss	False
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	574.33185	-17.011904	0	AAAAAAAAAVSR2_121_1_0_6	0.73629588	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	6	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	503.29471	-17.011904	0	AAAAAAAAAVSR2_121_1_0_7	0.47699517	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	5	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	214.11917	-17.011904	0	AAAAAAAAAVSR2_98_1_0_3	0.47343451	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	b	1	3	noloss	False
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	787.44318	-17.011904	0	AAAAAAAAAVSR2_121_1_0_3	0.39700398	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	9	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	285.15628	-17.011904	0	AAAAAAAAAVSR2_98_1_0_4	0.30815825	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	b	1	4	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	432.2576	-17.011904	0	AAAAAAAAAVSR2_121_1_0_8	0.26575705	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	4	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	356.19339	-17.011904	0	AAAAAAAAAVSR2_98_1_0_5	0.23726191	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	b	1	5	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	858.48029	-17.011904	0	AAAAAAAAAVSR2_121_1_0_2	0.23109815	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	10	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	427.2305	-17.011904	0	AAAAAAAAAVSR2_98_1_0_6	0.13046893	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	b	1	6	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral3/2023_12/20231213_OA3_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P27_70091_cb_H6_1424.mzML	500.78116	361.22049	-17.011904	0	AAAAAAAAAVSR2_121_1_0_9	0.11459313	AAAAAAAAAVSR2	0	AAAAAAAAAVSR	0	1.4398672e-05	0.002044061	0.63356501	Q96JP5;Q96JP5-2	ZFP91-2_HUMAN;ZFP91_HUMAN	ZFP91	AAAAAAAAAVSR	AAAAAAAAAVSR	2	AAAAAAAAAVSR	Q96JP5;Q96JP5-2;A0A0A6YYC7	0	0	y	1	3	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	672.40503	-14.478184	0	AAAAAAALQAK2_121_1_0_4	1	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	7	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	601.36786	-14.478184	0	AAAAAAALQAK2_121_1_0_5	0.81051117	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	6	noloss	False
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	214.11917	-14.478184	0	AAAAAAALQAK2_98_1_0_3	0.6025809	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	b	1	3	noloss	False
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	743.44214	-14.478184	0	AAAAAAALQAK2_121_1_0_3	0.55991524	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	8	noloss	False
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	530.33075	-14.478184	0	AAAAAAALQAK2_121_1_0_6	0.42974085	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	5	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	814.47925	-14.478184	0	AAAAAAALQAK2_121_1_0_2	0.40478998	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	9	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	285.15628	-14.478184	0	AAAAAAALQAK2_98_1_0_4	0.27873126	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	b	1	4	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	459.29367	-14.478184	0	AAAAAAALQAK2_121_1_0_7	0.23921044	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	4	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	346.20959	-14.478184	0	AAAAAAALQAK2_121_1_0_8	0.17267427	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	3	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	356.19339	-14.478184	0	AAAAAAALQAK2_98_1_0_5	0.11922429	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	b	1	5	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	427.2305	-14.478184	0	AAAAAAALQAK2_98_1_0_6	0.042955909	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	b	1	6	noloss	True
/fs/pool/pool-mann-ms14/MZML/Astral2/2023_12/20231206_OA2_ViAl_SA_FAIMS40_IO4_A556_MOMI-20231121_APAK_P35_72214_cb_A9_926.mzML	478.78064	885.51636	-14.478184	0	AAAAAAALQAK2_121_1_0_1	0.019872207	AAAAAAALQAK2	0	AAAAAAALQAK	1	1.5083094e-06	0.00029770765	0.97250301	P36578	RL4_HUMAN	RPL4	AAAAAAALQAK	AAAAAAALQAK	2	AAAAAAALQAK	P36578;H3BU31;H3BM89	0	0	y	1	10	noloss	True
    """


TEST_DATA_MSFRAGGER_SPECLIB = """ModifiedPeptide	PrecursorCharge	Tr_recalibrated	IonMobility	StrippedPeptide	PrecursorMz	ProteinID	Genes	FragmentType	FragmentMz	RelativeIntensity	FragmentCharge	FragmentNumber	FragmentLossType
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	547.3086	1.0	1	5	noloss
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	660.39264	0.51416683	1	6	noloss
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	b	213.15976	0.2875934	1	2	noloss
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	305.18195	0.28558257	1	3	noloss
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	418.26602	0.22692133	1	4	noloss
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	204.13426	0.14408894	1	2	noloss
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	330.69998	0.047275875	2	6	noloss
_VLELTGK_	2	4.249923	0.75	VLELTGK	380.234178887762	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	b	342.20236	0.039677892	1	3	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	305.18195	1.0	1	3	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	418.26602	0.7783308	1	4	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	b	342.20236	0.7754817	1	3	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	547.3086	0.5358066	1	5	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	b	556.3341	0.38568112	1	5	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	b	455.2864	0.2794164	1	4	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	b	213.15976	0.25726682	1	2	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	204.13426	0.19917944	1	2	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	y	660.39264	0.12131426	1	6	noloss
_VLELTGK_	1	4.249923	1.284	VLELTGK	759.4610813087119	A0A0B4J2D5;P0DPI2	GATD3B;GATD3	b	613.3555	0.11152817	1	6	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	y	269.67664	1.0	2	4	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	y	326.21866	0.9999356	2	5	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	y	538.346	0.90463305	1	4	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	y	401.28708	0.71957177	1	3	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	y	651.43005	0.6489045	1	5	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	b	229.11829	0.4481002	1	2	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	y	288.203	0.28588438	1	2	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	y	375.75287	0.16287889	2	6	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	b	479.26126	0.09841085	1	4	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	b	592.34534	0.06371137	1	5	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	b	342.20236	0.030663786	1	3	noloss
_EVLHLLR_	2	21.775629	0.837	EVLHLLR	440.274169715862	A0AVF1	TTC26	b	705.4294	0.02848413	1	6	noloss
"""

TEST_DATA_ALPHADIA = """base_width_mobility	base_width_rt	rt_observed	mobility_observed	mono_ms1_intensity	top_ms1_intensity	sum_ms1_intensity	weighted_ms1_intensity	weighted_mass_deviation	weighted_mass_error	mz_observed	mono_ms1_height	top_ms1_height	sum_ms1_height	weighted_ms1_height	isotope_intensity_correlation	isotope_height_correlation	n_observations	intensity_correlation	height_correlation	intensity_fraction	height_fraction	intensity_fraction_weighted	height_fraction_weighted	mean_observation_score	sum_b_ion_intensity	sum_y_ion_intensity	diff_b_y_ion_intensity	f_masked	fragment_scan_correlation	template_scan_correlation	fragment_frame_correlation	top3_frame_correlation	template_frame_correlation	top3_b_ion_correlation	n_b_ions	top3_y_ion_correlation	n_y_ions	cycle_fwhm	mobility_fwhm	delta_frame_peak	top_3_ms2_mass_error	mean_ms2_mass_error	n_overlapping	mean_overlapping_intensity	mean_overlapping_mass_error	precursor_idx	rank	scan_center	frame_start	elution_group_idx	frame_stop	frame_center	scan_stop	score	scan_start	i_3	genes	i_1	decoy	mods	channel	rt_library	mobility_library	i_0	flat_frag_start_idx	mod_sites	i_2	flat_frag_stop_idx	mz_library	rt_calibrated	charge	mz_calibrated	sequence	proteins	delta_rt	n_K	n_R	n_P	_decoy	proba	qval	_candidate_idx	valid	candidate_idx	run	mod_seq_hash	mod_seq_charge_hash	pg_master	pg	pg_qval	intensity
0.000000	38.684296	468.905731	0.000001	117961664.000000	117961664.000000	276840416.000000	95120688.000000	-0.197439	0.197439	781.368469	2849874.750000	2849874.750000	6788314.000000	2273957.500000	0.980586	0.999165	2.000000	0.992594	0.992708	1.000000	1.000000	1.000000	1.000000	0.999540	12.188647	15.848632	-3.659985	1.000000	0.000000	0.000000	0.798432	0.932817	0.908939	0.903936	1.000000	0.898678	11.000000	16.475826	0.000000	-0.950898	0.200608	0.123120	0.000000	0.000000	15.000000	138252	0	0	86989	144294	94514	90601	1	165.561066	0	0.067197	ACTN4_HUMAN;ACTN1_HUMAN	0.340936	0	Carbamidomethyl@C	0	649.565613	0.000000	0.416578	798982	10	0.175290	798994	781.369385	503.363037	2	781.368652	ELPPDQAEYCIAR	O43707;P12814	-34.457306	0	1	2	0.000000	0.000000	0.000000	138252	True	138252	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	356312820745498424	356312820745498426	O43707	O43707;P12814	0.000000	262684832.000000
0.000000	29.428162	799.346985	0.000001	172471648.000000	172471648.000000	372443296.000000	132807928.000000	-0.149760	0.149760	780.903625	6140298.500000	6140298.500000	13225659.000000	4718308.000000	0.999529	0.999349	2.000000	0.839249	0.848623	1.000000	1.000000	1.000000	1.000000	0.993265	12.386384	15.716099	-3.329715	1.000000	0.000000	0.000000	0.915426	0.954805	0.895610	0.949662	1.000000	0.924100	11.000000	16.276836	0.000000	4.326714	0.438759	0.270384	0.000000	0.000000	15.000000	70824	0	0	152005	77362	157724	154714	1	179.995453	0	0.054696	MDHM_HUMAN	0.353536	0		0	934.109009	0.000000	0.428233	395635		0.163536	395647	780.904480	801.701782	2	780.903748	VDFPQDQLTALTGR	P40926	-2.354797	0	1	1	0.000000	0.000000	0.000000	70824	True	70824	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	11614389154130684956	11614389154130684958	P40926	P40926	0.000000	475047904.000000
0.000000	38.753906	771.443054	0.000001	36718404.000000	46236852.000000	115443632.000000	34485244.000000	-0.225836	0.225836	815.066895	901491.000000	1039870.062500	2664748.250000	794324.937500	0.994666	0.923301	2.000000	0.643776	0.668077	1.000000	1.000000	1.000000	1.000000	0.999244	0.000000	13.672853	-13.672853	1.000000	0.000000	0.000000	0.575869	0.860494	0.736973	0.000000	0.000000	0.730470	12.000000	15.471613	0.000000	1.269739	0.145446	0.200313	0.000000	0.000000	0.000000	202873	0	0	145684	228359	153209	149296	1	150.637802	0	0.124058	XPO1_HUMAN	0.354805	0		0	934.640869	0.000000	0.271695	1186567		0.249441	1186579	815.067810	802.337952	3	815.067078	ESPFSTSASPLLSGSQHFDVPPR	O14980	-30.894897	0	1	4	0.000000	0.000000	0.000000	202873	True	202873	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	12985870821571390371	12985870821571390374	O14980	O14980	0.000000	92361648.000000
0.000000	26.381287	897.104309	0.000001	15801271.000000	15801271.000000	34494264.000000	12483384.000000	0.002076	0.002076	801.442139	760912.375000	760912.375000	1821588.500000	604467.875000	0.987542	0.932254	2.000000	0.991462	0.990591	1.000000	1.000000	1.000000	1.000000	0.999355	12.362812	13.572536	-1.209723	1.000000	0.000000	0.000000	0.689708	0.917982	0.741624	0.839265	3.000000	0.770252	9.000000	12.510526	0.000000	-0.154950	0.538326	0.240227	5.000000	218316.312500	0.223041	71317	0	0	171269	77906	176386	173677	1	145.581635	0	0.060914	STOM_HUMAN	0.358150	0		0	1044.497437	0.000000	0.406633	398598		0.174303	398610	801.442871	962.056458	2	801.442139	TISFDIPPQEILTK	P27105	-64.952148	1	0	2	0.000000	0.000000	0.000000	71317	True	71317	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	14730170521334343743	14730170521334343745	P27105	P27105	0.000000	4318146.500000
0.000000	32.594849	485.916473	0.000001	60743436.000000	60743436.000000	112744464.000000	40211136.000000	-0.202738	0.202738	732.845947	1625207.125000	1625207.125000	3720409.000000	1279807.375000	0.986145	0.959585	2.000000	0.991596	0.983993	1.000000	1.000000	1.000000	1.000000	0.987771	13.354678	13.772424	-0.417746	1.000000	0.000000	0.000000	0.598456	0.885584	0.699444	0.741315	4.000000	0.783508	8.000000	20.192419	0.000000	-0.015522	-0.208967	-0.336581	10.000000	592382.500000	-0.337369	145894	0	0	90902	152053	97223	93912	1	152.076385	0	0.073804	VDAC2_HUMAN	0.327288	0	Oxidation@M;Carbamidomethyl@C	0	668.930237	0.000000	0.418837	844788	2;3	0.180070	844800	732.846741	522.252808	2	732.846069	PMCIPPSYADLGK	P45880	-36.336334	1	0	3	0.000000	0.000000	0.000000	145894	True	145894	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	982954855425677958	982954855425677960	P45880	P45880	0.000000	299325664.000000
0.000000	38.783691	906.433289	0.000001	65143820.000000	104630336.000000	268791200.000000	77689856.000000	0.442150	0.442150	954.797424	2254158.750000	2149679.500000	7010069.500000	1960884.250000	0.891391	-0.294299	2.000000	0.963895	0.967029	1.000000	1.000000	1.000000	1.000000	0.993848	11.920059	15.353467	-3.433408	1.000000	0.000000	0.000000	0.850872	0.887961	0.901903	0.812896	2.000000	0.905956	10.000000	13.112668	0.000000	-0.880083	0.196391	0.338871	0.000000	0.000000	15.000000	215265	0	0	171871	244751	179396	175483	1	169.858383	0	0.157360	C1QBP_HUMAN	0.340862	0		0	1030.555908	0.000000	0.226113	1260916		0.275665	1260928	954.797913	922.991394	3	954.796997	ITVTFNINNSIPPTFDGEEEPSQGQK	Q07021	-16.558105	1	0	3	0.000000	0.000001	0.000000	215265	True	215265	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	8590257174128188000	8590257174128188003	Q07021	Q07021	0.000000	145234368.000000
0.000000	38.757477	397.475739	0.000001	28217610.000000	28217610.000000	68219968.000000	23764694.000000	0.336349	0.336349	537.271851	758974.187500	758974.187500	2233542.750000	688512.437500	0.729998	-0.415903	2.000000	0.790699	0.781838	1.000000	1.000000	1.000000	1.000000	0.997698	11.437778	14.088260	-2.650482	1.000000	0.000000	0.000000	0.485317	0.858773	0.620345	0.762407	1.000000	0.772462	11.000000	19.219673	0.000000	-0.175894	0.379773	0.136711	2.000000	214067.671875	0.571471	48965	0	0	73143	54507	80668	76755	1	142.536148	0	0.025535	SPRE_HUMAN	0.316663	0		0	568.471375	0.000000	0.552767	265905		0.105034	265917	537.272339	423.106506	2	537.271667	AFPDSPGLNR	P35270	-25.630768	0	1	2	0.000000	0.000001	0.000000	48965	True	48965	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	3772776820374352914	3772776820374352916	P35270	P35270	0.000000	27731554.000000
0.000000	20.141663	586.794312	0.000001	9397243.000000	14215656.000000	33782168.000000	9901883.000000	0.277126	0.277126	633.561157	583526.937500	854591.250000	2026379.375000	593828.875000	0.999902	0.992756	2.000000	0.966321	0.965479	1.000000	1.000000	1.000000	1.000000	0.999323	12.857821	13.060336	-0.202515	1.000000	0.000000	0.000000	0.681509	0.869236	0.713605	0.777565	2.000000	0.758457	10.000000	10.647584	0.000000	0.000000	0.231978	-0.785253	0.000000	0.000000	15.000000	225734	0	0	111671	254213	115584	113477	1	149.793503	0	0.144245	IPO4_HUMAN	0.343934	0		0	761.142761	0.000000	0.248972	1323724		0.262849	1323736	633.561646	617.091736	4	633.560974	SNAIFGMGVLAEHGGHPAQEHFPK	Q8TEX9	-30.297424	1	0	2	0.000000	0.000001	0.000000	225734	True	225734	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	6918310338105444434	6918310338105444438	Q8TEX9	Q8TEX9	0.000000	15150874.000000
0.000000	32.549194	647.208740	0.000001	78696728.000000	78696728.000000	185137664.000000	59410000.000000	0.039330	0.039330	885.894165	2721039.000000	2721039.000000	6789193.000000	2129041.500000	0.995651	0.969176	2.000000	0.845647	0.854093	1.000000	1.000000	1.000000	1.000000	0.988729	12.955585	14.201138	-1.245552	1.000000	0.000000	0.000000	0.881185	0.973740	0.907947	0.917563	3.000000	0.910428	9.000000	12.589879	0.000000	0.196480	-0.080858	-0.132250	4.000000	423196.718750	-0.327340	147918	0	0	122206	154468	128527	125216	1	171.739258	0	0.094921	EF1A1_HUMAN;EF1A3_HUMAN	0.338173	0	Carbamidomethyl@C;Oxidation@M	0	802.456543	0.000000	0.359700	856924	3;2	0.207206	856936	885.894897	661.182068	2	885.894104	PMCVESFSDYPPLGR	P68104;Q5VTE0	-13.973328	0	1	3	0.000000	0.000001	0.000000	147918	True	147918	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	15362985462235010329	15362985462235010331	P68104	P68104	0.000000	815334912.000000
0.000000	41.834106	974.628174	0.000001	165227184.000000	165227184.000000	341108032.000000	122995368.000000	-0.865829	0.865829	733.376099	2909783.250000	2909783.250000	7382808.000000	2476277.750000	0.992593	0.999685	2.000000	0.698670	0.684436	1.000000	1.000000	1.000000	1.000000	0.999496	12.364261	15.599504	-3.235244	1.000000	0.000000	0.000000	0.851021	0.948106	0.909501	0.922384	1.000000	0.928403	11.000000	14.981044	0.000000	-1.060805	0.116595	0.033192	0.000000	0.000000	15.000000	133803	0	0	184814	139650	192941	188727	1	172.372528	0	0.053518	APT_HUMAN	0.358100	0		0	1063.076416	0.000000	0.424231	772339		0.164152	772351	733.377380	1049.455200	2	733.376709	SFPDFPTPGVVFR	P07741	-74.827026	0	1	3	0.000000	0.000001	0.000000	133803	True	133803	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	17540424267576847589	17540424267576847591	P07741	P07741	0.000000	53231792.000000
0.000000	11.008911	1024.277954	0.000001	1524684.875000	3386851.250000	8038971.000000	2271469.000000	0.033563	0.033563	949.751221	374169.312500	420662.250000	1582569.875000	434600.687500	0.977263	0.279989	2.000000	0.909695	0.935216	1.000000	1.000000	1.000000	1.000000	0.995806	6.323622	12.211502	-5.887880	1.000000	0.000000	0.000000	0.756341	0.941635	0.815973	0.673989	1.000000	0.868048	11.000000	3.679960	0.000000	0.000000	-0.707012	-0.731091	0.000000	0.000000	15.000000	225728	0	0	197456	254210	199563	198359	1	139.844086	0	0.187717	ODO2_HUMAN	0.313080	0	Carbamidomethyl@C	0	1064.338745	0.000000	0.218444	1323688	6	0.280759	1323700	949.752075	1057.163086	3	949.751160	EAQNTCAMLTTFNEIDMSNIQEMR	P36957	-32.885132	0	1	0	0.000000	0.000001	0.000000	225728	True	225728	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	8557271862936193567	8557271862936193570	P36957	P36957	0.000000	24902678.000000
0.000000	10.860962	1008.744995	0.000001	3999711.500000	3999711.500000	9254639.000000	3014435.250000	-0.149881	0.149881	929.471436	397106.437500	397106.437500	1127709.250000	353733.125000	0.983249	0.955436	2.000000	0.944415	0.949637	1.000000	1.000000	1.000000	1.000000	0.999109	10.945631	12.541185	-1.595554	1.000000	0.000000	0.000000	0.753762	0.931099	0.745020	0.818416	3.000000	0.836003	9.000000	4.774218	0.000000	-0.046634	-0.297710	-0.196394	0.000000	0.000000	15.000000	197745	0	0	194446	221292	196553	195349	1	143.535873	0	0.086317	EFTU_HUMAN	0.348320	0	Carbamidomethyl@C	0	1060.158569	0.000000	0.363921	1155799	13	0.201442	1155811	929.472412	1032.505127	2	929.471558	GEETPVIVGSALCALEGR	P49411	-23.760132	0	1	1	0.000000	0.000001	0.000000	197745	True	197745	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	12664170809160427286	12664170809160427288	P49411	P49411	0.000000	274689760.000000
0.000000	20.148621	603.861023	0.000001	33070404.000000	33070404.000000	73616120.000000	25814338.000000	-0.388525	0.388525	789.879944	1415316.750000	1415316.750000	3517859.750000	1194568.875000	0.999324	0.994222	2.000000	0.619943	0.606476	1.000000	1.000000	1.000000	1.000000	0.988536	12.127399	14.197652	-2.070252	1.000000	0.000000	0.000000	0.788009	0.959173	0.823009	0.874963	1.000000	0.869795	11.000000	9.725189	0.000000	-0.826260	-0.002330	0.072453	0.000000	0.000000	15.000000	127795	0	0	114982	133401	118895	116788	1	164.782745	0	0.057024	ERP44_HUMAN	0.355439	0		0	754.599915	0.000000	0.419887	736321		0.167651	736333	789.880981	610.108398	2	789.880249	EEFPNENQVVFAR	Q9BS26	-6.247375	0	1	1	0.000000	0.000001	0.000000	127795	True	127795	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	14197107769485222343	14197107769485222345	Q9BS26	Q9BS26	0.000000	43529504.000000
0.000000	10.837158	1061.634277	0.000001	2148339.000000	7884404.000000	14893706.000000	4279646.500000	0.109757	0.109757	954.983093	360683.718750	779712.875000	1624330.125000	446805.187500	0.887816	0.777366	2.000000	0.982358	0.964320	1.000000	1.000000	1.000000	1.000000	0.999123	9.727654	12.683957	-2.956304	1.000000	0.000000	0.000000	0.777308	0.959445	0.596602	0.679127	1.000000	0.891361	11.000000	3.758065	0.000000	-0.135218	-0.658768	-0.550391	0.000000	0.000000	15.000000	222172	0	0	204680	251020	206787	205583	1	145.893555	0	0.230617	DESP_HUMAN	0.301519	0		0	1067.131348	0.000000	0.152519	1302352		0.315346	1302364	954.983887	1074.987793	4	954.982971	QPVTVTELVDSGILRPSTVNELESGQISYDEVGER	P15924	-13.353516	0	2	2	0.000000	0.000001	0.000000	222172	True	222172	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	7992054407087330	7992054407087334	P15924	P15924	0.000000	87901776.000000
0.000000	26.283691	524.791687	0.000001	10973229.000000	10973229.000000	28292164.000000	9459815.000000	0.166340	0.166340	813.376831	735277.687500	735277.687500	1806419.000000	598327.500000	0.927310	0.999395	2.000000	0.979837	0.983290	1.000000	1.000000	1.000000	1.000000	0.999461	10.701322	13.432240	-2.730919	1.000000	0.000000	0.000000	0.705079	0.902651	0.813754	0.703513	2.000000	0.806521	10.000000	9.730261	0.000000	0.889893	-0.038362	-0.651927	0.000000	0.000000	15.000000	136827	0	0	99029	142832	104146	101437	1	146.789581	0	0.070366	DHX15_HUMAN	0.340558	0	Oxidation@M	0	666.942261	0.000000	0.409897	790452	3	0.179179	790464	813.377441	520.307068	2	813.376709	TEMQDNTYPEILR	O43143	4.484619	0	1	1	0.000000	0.000001	0.000000	136827	True	136827	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	15027125019830948057	15027125019830948059	O43143	O43143	0.000000	88564000.000000
0.000000	20.314758	1021.150818	0.000001	33402620.000000	60994640.000000	142707632.000000	40415196.000000	0.185850	0.185850	947.119751	1273061.000000	2329747.750000	5449783.000000	1543622.250000	0.983089	0.983682	2.000000	0.966489	0.963223	1.000000	1.000000	1.000000	1.000000	0.999597	12.184991	14.500943	-2.315952	1.000000	0.000000	0.000000	0.758419	0.940572	0.890876	0.888036	1.000000	0.886078	11.000000	7.490921	0.000000	-0.070775	0.120102	0.234566	0.000000	0.000000	15.000000	202804	0	0	195951	228274	199864	197757	1	164.382324	0	0.185348	DHX9_HUMAN	0.323082	0	Carbamidomethyl@C	0	1061.838623	0.000000	0.203855	1186147	12	0.287716	1186159	947.120483	1042.115356	3	947.119568	TYPVQEYFLEDCIQMTHFVPPPK	Q08211	-20.964539	1	0	4	0.000000	0.000001	0.000000	202804	True	202804	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	3873380558568274349	3873380558568274352	Q08211	Q08211	0.000000	201120464.000000
0.000000	26.357971	689.128296	0.000001	34344992.000000	34344992.000000	77898240.000000	24205060.000000	0.004578	0.004578	857.843079	1154157.125000	1154157.125000	3067391.750000	941147.250000	0.908729	0.971914	2.000000	0.958857	0.953880	1.000000	1.000000	1.000000	1.000000	0.990000	11.383165	13.894946	-2.511781	1.000000	0.000000	0.000000	0.738105	0.922401	0.831323	0.835890	1.000000	0.843725	11.000000	8.724017	0.000000	-0.196268	-0.153944	-0.123412	0.000000	0.000000	15.000000	191680	0	0	130935	211360	136052	133343	1	161.198883	0	0.107577	HNRPM_HUMAN	0.313825	0		0	812.162842	0.000000	0.363127	1119426		0.215471	1119438	857.843872	671.460938	2	857.843079	MGGMEGPFGGGMENMGR	P52272	17.667358	0	1	1	0.000000	0.000001	0.000000	191680	True	191680	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	14147753903278875309	14147753903278875311	P52272	P52272	0.000000	201781504.000000
0.000000	17.052856	737.339050	0.000001	8122413.000000	11355399.000000	27542220.000000	7753402.000000	0.330536	0.330536	971.426636	565878.937500	799007.562500	1947302.000000	548444.187500	0.844671	0.884281	1.000000	0.835958	0.799651	1.000000	1.000000	1.000000	1.000000	1.000000	11.395377	13.525781	-2.130404	1.000000	0.000000	0.000000	0.856718	0.962069	0.894629	0.868243	2.000000	0.907586	10.000000	5.916491	0.000000	0.000000	0.277163	0.151539	0.000000	0.000000	15.000000	216406	0	0	141169	245753	144480	142674	1	155.870514	0	0.173143	OTUB1_HUMAN	0.325829	0	Carbamidomethyl@C;Oxidation@M	0	876.346741	0.000000	0.223887	1267756	13;21	0.277141	1267768	971.427307	740.840576	3	971.426331	QEPLGSDSEGVNCLAYDEAIMAQQDR	Q96FW1	-3.501526	0	1	1	0.000000	0.000001	0.000000	216406	True	216406	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	8082832993259321650	8082832993259321653	Q96FW1	Q96FW1	0.000000	12885656.000000
0.000000	23.218170	478.136536	0.000001	47287720.000000	47287720.000000	103160832.000000	35323052.000000	0.115914	0.115914	814.408447	2255153.500000	2255153.500000	4697757.500000	1608062.375000	0.995569	0.958808	2.000000	0.986688	0.985935	1.000000	1.000000	1.000000	1.000000	0.964126	11.307899	14.320309	-3.012409	1.000000	0.000000	0.000000	0.751590	0.877583	0.871861	0.791852	2.000000	0.853721	10.000000	9.519076	0.000000	0.475635	-0.453033	-0.245890	0.000000	0.000000	15.000000	151292	0	0	90300	158620	94815	92407	1	164.662384	0	0.070001	SDHA_HUMAN	0.342278	0	Carbamidomethyl@C	0	685.724060	0.000000	0.408410	877157	7	0.179311	877169	814.409058	538.778748	2	814.408325	TLNEADCATVPPAIR	P31040	-60.642212	0	1	2	0.000000	0.000001	0.000000	151292	True	151292	20231017_OA2_TiHe_ADIAMA_HeLa_200ng_Evo011_21min_F-40_05	9468970119801002700	9468970119801002702	P31040	P31040	0.000000	37709348.000000
    """

current_file_directory = os.path.dirname(os.path.abspath(__file__))
test_data_path = Path(f"{current_file_directory}/reference_data")

# TODO add tests for AlphaPept


def _assert_reference_df_equal(
    psm_df: pd.DataFrame, test_case_name: str, loose_check: bool = False
) -> None:
    """Compare the output of a PSM reader against reference data.

    If reference is not present, save the output as reference data and raise.
    """
    out_file_path = test_data_path / f"reference_{test_case_name}.parquet"
    # psm_df.to_csv(test_data_path / f"reference_{test_case_name}.csv")

    # check that all columns are available in PsmDfCols
    assert (
        set(psm_df.columns)
        - set(PsmDfCols.get_values())
        - set(LibPsmDfCols.get_values())
        == set()
    )

    if out_file_path.exists():
        expected_df = pd.read_parquet(out_file_path)

        # TODO find out why some results differ in order on the github runner
        if loose_check:
            # check that the data is the same, but ignore the order
            columns_to_sort_by = ["rt", "raw_name"]
            psm_df = psm_df.sort_values(by=columns_to_sort_by).reset_index(drop=True)
            expected_df = expected_df.sort_values(by=columns_to_sort_by).reset_index(
                drop=True
            )

        try:
            pd.testing.assert_frame_equal(psm_df, expected_df, check_like=loose_check)
        except AssertionError as e:
            # for whatever reason, columns are int32 on windows runners
            logging.warning(f"Converting int32 to int64 for comparison: {e}")

            for column in psm_df.columns:
                if psm_df[column].dtype == np.int32:
                    psm_df[column] = psm_df[column].astype(np.int64)

            pd.testing.assert_frame_equal(psm_df, expected_df, check_like=loose_check)

    else:
        psm_df.to_parquet(out_file_path)
        raise ValueError("No reference data found.")


def test_psm_reader_yaml() -> None:
    """Test that all column mappings in the psm_reader.yaml are covered by string constant keys."""
    for reader_config in psm_reader_yaml.values():
        if reader_config == "modification_mappings":
            continue
        if "column_mapping" not in reader_config:
            continue
        ks = [k for k in reader_config["column_mapping"]]
        assert (
            set(ks) - set(PsmDfCols.get_values()) - set(LibPsmDfCols.get_values())
            == set()
        )


def test_maxquant_reader() -> None:
    """Test the MaxQuant reader."""

    input_data = io.StringIO(TEST_DATA_MAXQUANT)

    reader = MaxQuantReader()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "maxquant")


def test_maxquant_reader_with_mod() -> None:
    """Test the MaxQuant reader with manual intervention on modifications."""

    input_data = io.StringIO(TEST_DATA_MAXQUANT)

    reader = MaxQuantReader()
    mod_key = "Acetyl@Protein_N-term"

    # first check that the data changes without the mod
    mod_value = reader.modification_mapping.pop(mod_key)  # _(Acetyl (Protein_N-term))
    reader.add_modification_mapping(
        {"NOT_EXISTING_MODIFICATION": "NOT_EXISTING_MODIFICATION"}
    )

    reader.import_file(input_data)

    with pytest.raises(AssertionError):
        _assert_reference_df_equal(reader.psm_df, "maxquant")
        raise ValueError("Did not raise!")

    # re-add the mod
    reader.add_modification_mapping({mod_key: mod_value})
    reader.import_file(input_data)
    _assert_reference_df_equal(reader.psm_df, "maxquant")


def test_pfind_reader() -> None:
    """Test the pFind reader."""
    input_data = StringIO(TEST_DATA_PFIND)
    reader = pFindReader()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "pfind")


def test_diann_reader() -> None:
    """Test the Diann reader."""
    input_data = StringIO(TEST_DATA_DIANN)

    reader = DiannReader()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "diann")


def test_diann_181_tsv_reader() -> None:
    """Test the Diann reader with extended input from v1.8.1."""

    url = "https://datashare.biochem.mpg.de/s/Hk41INtwBvBl0kP/download?files=diann_1.8.1_report_head.tsv"
    file_path = DataShareDownloader(
        url=url, output_dir=current_file_directory + "/input_data/"
    ).download()

    reader = DiannReader()
    reader.import_file(file_path)

    _assert_reference_df_equal(reader.psm_df, "diann_1.8.1_tsv", loose_check=True)


def test_diann_190_tsv_reader() -> None:
    """Test the Diann reader with extended input from v1.9.0."""

    url = "https://datashare.biochem.mpg.de/s/Hk41INtwBvBl0kP/download?files=diann_1.9.0_report_head.tsv"
    file_path = DataShareDownloader(
        url=url, output_dir=current_file_directory + "/input_data/"
    ).download()

    reader = DiannReader()
    reader.import_file(file_path)

    _assert_reference_df_equal(reader.psm_df, "diann_1.9.0_tsv", loose_check=True)


def test_spectronaut_reader() -> None:
    """Test the Spectronaut reader."""
    input_data = StringIO(TEST_DATA_SPECTRONAUT)

    reader = SpectronautReader()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "spectronaut")


@skip  # TODO currently not working due to missing column EG.PrecursorId in input data
def test_spectronaut_report_reader_186() -> None:
    """Test the Spectronaut report reader with extended input from v18.6."""

    url = "https://datashare.biochem.mpg.de/s/Hk41INtwBvBl0kP/download?files=spectronaut_18.6_report_head.tsv"
    file_path = DataShareDownloader(
        url=url, output_dir=current_file_directory + "/input_data/"
    ).download()

    reader = SpectronautReportReader()
    reader.import_file(file_path)

    _assert_reference_df_equal(reader.psm_df, "spectronaut_18.6_report")


def test_spectronaut_reader_with_mod() -> None:
    """Test the Spectronaut reader with manual intervention on the modifications."""
    input_data = StringIO(TEST_DATA_SPECTRONAUT)

    reader = SpectronautReader()
    mod_key = "Phospho@S"

    # first check that the data changes without the mod
    mod_value = reader.modification_mapping.pop(mod_key)  # _(Acetyl (Protein_N-term))
    reader.add_modification_mapping(
        {"NOT_EXISTING_MODIFICATION": "NOT_EXISTING_MODIFICATION"}
    )

    reader.import_file(input_data)

    with pytest.raises(AssertionError):
        _assert_reference_df_equal(reader.psm_df, "spectronaut")
        raise ValueError("Did not raise!")

    # re-add the mod
    reader.add_modification_mapping({mod_key: mod_value})
    reader.import_file(input_data)
    _assert_reference_df_equal(reader.psm_df, "spectronaut")


def test_spectronaut_report_reader() -> None:
    """Test the Spectronaut report reader."""
    input_data = StringIO(TEST_DATA_SPECTRONAUT_REPORT)

    reader = SpectronautReportReader()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "spectronaut_report")


def test_openswath_reader() -> None:
    """Test the OpenSwath reader."""

    input_data = StringIO(TEST_DATA_OPENSWATH)

    reader = SwathReader()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "openswath")


def test_sage_reader() -> None:
    """Test the Sage TSV reader."""

    input_data = StringIO(TEST_DATA_SAGE)

    reader = SageReaderTSV(mp_process_num=1)
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "sage", loose_check=True)


def test_alphadia_reader() -> None:
    input_data = StringIO(TEST_DATA_ALPHADIA)

    reader = AlphaDiaReaderTsv()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "alphadia", loose_check=True)


def test_alphadia_reader_181() -> None:
    """Test the AlphaDIA reader with extended input from v1.8.1."""

    url = "https://datashare.biochem.mpg.de/s/Hk41INtwBvBl0kP/download?files=alphadia_1.8.1_report_head.tsv"
    file_path = DataShareDownloader(
        url=url, output_dir=current_file_directory + "/input_data/"
    ).download()

    reader = AlphaDiaReaderTsv()
    reader.import_file(file_path)

    _assert_reference_df_equal(reader.psm_df, "alphadia_1.8.1_tsv", loose_check=True)


def test_diann_speclib_reader() -> None:
    """Test the Diann speclib reader."""
    # this is the head of  "https://datashare.biochem.mpg.de/s/DF12ObSdZnBnqUV" ("diann_speclib.tsv")
    input_data = StringIO(TEST_DATA_DIANN_SPECLIB)

    reader = LibraryReaderBase()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "diann_speclib")


def test_msfragger_speclib_reader() -> None:
    """Test the MSFragger speclib reader."""

    # this is the head of https://datashare.biochem.mpg.de/s/Cka1utORt3r5A4a ("msfragger_speclib.tsv")
    input_data = StringIO(TEST_DATA_MSFRAGGER_SPECLIB)

    reader = LibraryReaderBase()
    reader.import_file(input_data)

    _assert_reference_df_equal(reader.psm_df, "msfragger_speclib")
